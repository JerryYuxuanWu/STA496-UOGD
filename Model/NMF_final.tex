% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={NMF Final (Only nndsvd 5 component without ozone)},
  pdfauthor={William Zhang, Eva, Jerry, Meredith},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{NMF Final (Only nndsvd 5 component without ozone)}
\author{William Zhang, Eva, Jerry, Meredith}
\date{2025-01-24}

\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# load the packages}
\FunctionTok{library}\NormalTok{(NMF)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(grid)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{library}\NormalTok{(readxl)}
\FunctionTok{library}\NormalTok{(circular)}
\FunctionTok{library}\NormalTok{(lwgeom)}
\FunctionTok{library}\NormalTok{(units)}
\end{Highlighting}
\end{Shaded}

\section{Procedure}\label{procedure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Remove hourly observation with missing observation for any chemical
\item
  Remove background noise level using min values (except for chemicals
  with minimum value \textless{} 2*LOD and maximum value \textgreater{}
  100*LOD)
\item
  Zero values are converted to a random value between 0 and 0.5*LOD
\item
  Normalize using min and max
\item
  Remove Ozone (wouldn't affect \# of obs.)
\end{enumerate}

\subsection{Reading the data}\label{reading-the-data}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hourly\_data }\OtherTok{\textless{}{-}} \FunctionTok{readRDS}\NormalTok{(}\StringTok{"../DataProcessing/Trailer\_hourly\_merge\_20240905.rds"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# PROCEDURE STEP 1:}
\NormalTok{hourly\_data }\OtherTok{\textless{}{-}}\NormalTok{ hourly\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{rename}\NormalTok{(}\StringTok{\textquotesingle{}co2\textquotesingle{}} \OtherTok{=} \StringTok{\textquotesingle{}co2\_ppm\textquotesingle{}}\NormalTok{)}

\NormalTok{vocs }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"ethane"}\NormalTok{, }\StringTok{"ethene"}\NormalTok{, }\StringTok{"propane"}\NormalTok{, }\StringTok{"propene"}\NormalTok{,}
                                        \StringTok{"1\_3{-}butadiene"}\NormalTok{, }\StringTok{"i{-}butane"}\NormalTok{, }\StringTok{"n{-}butane"}\NormalTok{,}
                                        \StringTok{"acetylene"}\NormalTok{, }\StringTok{"cyclopentane"}\NormalTok{, }\StringTok{"i{-}pentane"}\NormalTok{,}
                                        \StringTok{"n{-}pentane"}\NormalTok{, }\StringTok{"n{-}hexane"}\NormalTok{, }\StringTok{"isoprene"}\NormalTok{, }\StringTok{"n{-}heptane"}\NormalTok{,}
                                        \StringTok{"benzene"}\NormalTok{, }\StringTok{"n{-}octane"}\NormalTok{, }\StringTok{"toluene"}\NormalTok{, }\StringTok{"ethyl{-}benzene"}\NormalTok{, }
                                        \StringTok{"m\&p{-}xylene"}\NormalTok{, }\StringTok{"o{-}xylene"}\NormalTok{)}


\NormalTok{non\_vocs }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}ch4\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}co2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}co\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}h2s\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}so2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}nox\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}o3\textquotesingle{}}\NormalTok{)}

\CommentTok{\# remove row with missing obs for any chemical}
\NormalTok{hourly\_nona }\OtherTok{\textless{}{-}}\NormalTok{ hourly\_data }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(}\FunctionTok{any\_of}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}day\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}time\_utc\textquotesingle{}}\NormalTok{, vocs, non\_vocs, }\StringTok{\textquotesingle{}wdr\_deg\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wsp\_ms\textquotesingle{}}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{na.omit}\NormalTok{()}

\CommentTok{\# retrieving the vocs, removing everything else except the vocs}
\NormalTok{hourly\_vocs }\OtherTok{\textless{}{-}}\NormalTok{ hourly\_nona }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{any\_of}\NormalTok{(vocs))}

\CommentTok{\# retrieving the non{-}vocs: co2\_ppm, nox, ch4, h2s, so2, o3}
\CommentTok{\# double check this}
\NormalTok{hourly\_non\_vocs }\OtherTok{\textless{}{-}}\NormalTok{ hourly\_nona }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{any\_of}\NormalTok{(non\_vocs)) }

\NormalTok{hourly\_full\_nona }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(hourly\_non\_vocs, hourly\_vocs)}

\CommentTok{\# retrive a vector of yearmonth}
\NormalTok{hourly\_dates }\OtherTok{\textless{}{-}}\NormalTok{ hourly\_nona }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{yearmonth =} \FunctionTok{substring}\NormalTok{(day, }\DecValTok{0}\NormalTok{, }\DecValTok{7}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pull}\NormalTok{(yearmonth)}
\end{Highlighting}
\end{Shaded}

\subsection{Data visualisation}\label{data-visualisation}

\begin{itemize}
\tightlist
\item
  Boxplots of the hourly concentrations non-voc
\end{itemize}

\includegraphics[width=0.7\linewidth]{NMF_final_files/figure-latex/unnamed-chunk-3-1}

\begin{itemize}
\tightlist
\item
  Boxplots sulfur compounds, NOx, ozone
\end{itemize}

\includegraphics[width=0.7\linewidth]{NMF_final_files/figure-latex/unnamed-chunk-4-1}

\begin{itemize}
\tightlist
\item
  Boxplots VOCs
\end{itemize}

\includegraphics[width=0.7\linewidth]{NMF_final_files/figure-latex/unnamed-chunk-5-1}

\includegraphics[width=0.7\linewidth]{NMF_final_files/figure-latex/unnamed-chunk-6-1}

\includegraphics[width=0.7\linewidth]{NMF_final_files/figure-latex/unnamed-chunk-7-1}

\includegraphics[width=0.7\linewidth]{NMF_final_files/figure-latex/unnamed-chunk-8-1}

\includegraphics[width=0.7\linewidth]{NMF_final_files/figure-latex/unnamed-chunk-9-1}

\subsubsection{Data pre-processing}\label{data-pre-processing}

\paragraph{Step 1: limits of
detection}\label{step-1-limits-of-detection}

\begin{itemize}
\tightlist
\item
  STEP 1: Limits of detection
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define LOD for each chemical}
\NormalTok{LOD\_non\_voc }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}ch4\textquotesingle{}} \OtherTok{=} \FloatTok{0.9}\NormalTok{, }
             \StringTok{\textquotesingle{}co2\textquotesingle{}} \OtherTok{=} \FloatTok{0.0433}\NormalTok{, }
             \StringTok{\textquotesingle{}co\textquotesingle{}} \OtherTok{=} \DecValTok{40}\NormalTok{,}
             \StringTok{\textquotesingle{}h2s\textquotesingle{}} \OtherTok{=} \FloatTok{0.4}\NormalTok{, }
             \StringTok{\textquotesingle{}so2\textquotesingle{}} \OtherTok{=} \FloatTok{0.4}\NormalTok{,}
             \StringTok{\textquotesingle{}nox\textquotesingle{}} \OtherTok{=} \FloatTok{0.05}\NormalTok{, }
             \StringTok{\textquotesingle{}o3\textquotesingle{}} \OtherTok{=} \DecValTok{1}\NormalTok{)}

\CommentTok{\# LOD\_voc\_monthly \textless{}{-} read\_csv(\textquotesingle{}../data/LNM\_VOC\_LOD\_Rounded.csv\textquotesingle{}) \%\textgreater{}\% select({-}1)}
\CommentTok{\# }
\CommentTok{\# \# extract the yearmonth from date variables}
\CommentTok{\# LOD\_voc\_monthly \textless{}{-} LOD\_voc\_monthly \%\textgreater{}\%}
\CommentTok{\#   mutate(yearmonth = strftime(as.POSIXct(start\_date, format = \textquotesingle{}\%Y{-}\%m{-}\%d \%H:\%M:\%S\textquotesingle{}, }
\CommentTok{\#                                             tz = \textquotesingle{}UTC\textquotesingle{}), \textquotesingle{}\%Y{-}\%m\textquotesingle{})) }
\CommentTok{\# }
\CommentTok{\# LOD\_voc\_monthly \textless{}{-} LOD\_voc\_monthly \%\textgreater{}\% }
\CommentTok{\#   select({-}c(start\_date, end\_date)) \%\textgreater{}\%}
\CommentTok{\#   select(!any\_of(ends\_with(\textquotesingle{}half\_ldl\textquotesingle{})))}
\CommentTok{\# }
\CommentTok{\# colnames(LOD\_voc\_monthly) \textless{}{-} str\_replace\_all(names(LOD\_voc\_monthly), \textquotesingle{}\_ldl\textquotesingle{}, \textquotesingle{}\textquotesingle{})}

\NormalTok{LOD\_voc\_avg }\OtherTok{\textless{}{-}} \FunctionTok{read\_xlsx}\NormalTok{(}\StringTok{\textquotesingle{}../data/LNM\_VOC\_Uncertainties.xlsx\textquotesingle{}}\NormalTok{, }\AttributeTok{skip =} \DecValTok{1}\NormalTok{)}
\NormalTok{LOD\_voc\_avg }\OtherTok{\textless{}{-}}\NormalTok{ LOD\_voc\_avg }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{4}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{\textquotesingle{}LOD\textquotesingle{}} \OtherTok{=} \DecValTok{2}\NormalTok{, }\StringTok{\textquotesingle{}chemical\textquotesingle{}} \OtherTok{=} \DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{head}\NormalTok{(}\DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\paragraph{Step 2: Background
correction}\label{step-2-background-correction}

\begin{itemize}
\tightlist
\item
  STEP 2: Background correction
\end{itemize}

\begin{verbatim}
##           ch4           co2            co           h2s           so2 
##      1928.000       411.300        59.910         0.200         0.200 
##           nox            o3        ethane        ethene       propane 
##         0.025         0.500         0.916         0.011         0.224 
##       propene 1_3-butadiene      i-butane      n-butane     acetylene 
##         0.009         0.007         0.035         0.090         0.019 
##  cyclopentane     i-pentane     n-pentane      n-hexane      isoprene 
##         0.005         0.038         0.042         0.021         0.005 
##     n-heptane       benzene      n-octane       toluene ethyl-benzene 
##         0.004         0.017         0.004         0.004         0.004 
##    m&p-xylene      o-xylene 
##         0.004         0.004
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Summary statistics of backgrounds and extremes
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{get\_info }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(column) \{}
\NormalTok{  N }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(column)}
\NormalTok{  background }\OtherTok{\textless{}{-}} \FunctionTok{quantile}\NormalTok{(column, }\DecValTok{0}\NormalTok{)}
\NormalTok{  quantile1 }\OtherTok{\textless{}{-}} \FunctionTok{quantile}\NormalTok{(column, }\FloatTok{0.01}\NormalTok{)}
\NormalTok{  quantile99 }\OtherTok{\textless{}{-}} \FunctionTok{quantile}\NormalTok{(column, }\FloatTok{0.99}\NormalTok{)}
\NormalTok{  n\_background }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(column }\SpecialCharTok{==}\NormalTok{ background)}
\NormalTok{  max }\OtherTok{\textless{}{-}} \FunctionTok{max}\NormalTok{(column)}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{c}\NormalTok{(N, quantile1, quantile99, max, background, n\_background))}
\NormalTok{\}}

\NormalTok{info\_table }\OtherTok{\textless{}{-}}\NormalTok{ hourly\_full\_nona }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{reframe}\NormalTok{(}\FunctionTok{across}\NormalTok{(}\FunctionTok{everything}\NormalTok{(), }\SpecialCharTok{\textasciitilde{}} \FunctionTok{get\_info}\NormalTok{(.x)))}

\NormalTok{info\_table }\OtherTok{\textless{}{-}}\NormalTok{ info\_table }\SpecialCharTok{\%\textgreater{}\%}  
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{rownames =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}N\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}1st percentile\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}99th percentile\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Max\textquotesingle{}}\NormalTok{, }
                      \StringTok{\textquotesingle{}Background\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}\# Background\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_longer}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{rownames) }\SpecialCharTok{\%\textgreater{}\%}   
  \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{names\_from =}\NormalTok{ rownames, }\AttributeTok{values\_from =}\NormalTok{ value) }

\NormalTok{knitr}\SpecialCharTok{::}\FunctionTok{kable}\NormalTok{(info\_table)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1667}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.0595}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1786}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1905}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1190}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1310}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1548}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
name
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
N
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
1st percentile
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
99th percentile
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
Max
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
Background
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
\# Background
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
ch4 & 4788 & 1962.98700 & 6286.12400 & 34010.900 & 1928.000 & 1 \\
co2 & 4788 & 416.47870 & 460.62260 & 503.990 & 411.300 & 1 \\
co & 4788 & 84.23050 & 442.08860 & 2513.440 & 59.910 & 1 \\
h2s & 4788 & 0.20000 & 5.20986 & 27.700 & 0.200 & 829 \\
so2 & 4788 & 0.20000 & 1.78686 & 8.578 & 0.200 & 3266 \\
nox & 4788 & 0.22974 & 89.72371 & 452.959 & 0.025 & 2 \\
o3 & 4788 & 0.50000 & 76.02600 & 103.100 & 0.500 & 259 \\
ethane & 4788 & 1.84422 & 526.44700 & 2060.000 & 0.916 & 1 \\
ethene & 4788 & 0.01100 & 3.50826 & 16.970 & 0.011 & 163 \\
propane & 4788 & 0.84674 & 300.79000 & 1211.000 & 0.224 & 1 \\
propene & 4788 & 0.00900 & 0.69739 & 5.528 & 0.009 & 411 \\
1\_3-butadiene & 4788 & 0.00700 & 0.05900 & 1.207 & 0.007 & 3357 \\
i-butane & 4788 & 0.15148 & 60.89400 & 296.600 & 0.035 & 1 \\
n-butane & 4788 & 0.37248 & 166.52100 & 536.900 & 0.090 & 1 \\
acetylene & 4788 & 0.04900 & 2.61304 & 8.471 & 0.019 & 2 \\
cyclopentane & 4788 & 0.00500 & 3.06899 & 13.460 & 0.005 & 96 \\
i-pentane & 4788 & 0.10987 & 49.60210 & 215.900 & 0.038 & 1 \\
n-pentane & 4788 & 0.10487 & 55.95980 & 258.800 & 0.042 & 1 \\
n-hexane & 4788 & 0.04300 & 18.17780 & 93.360 & 0.021 & 2 \\
isoprene & 4788 & 0.00500 & 0.03313 & 0.362 & 0.005 & 2816 \\
n-heptane & 4788 & 0.01500 & 6.57669 & 30.470 & 0.004 & 5 \\
benzene & 4788 & 0.02800 & 3.78693 & 9.610 & 0.017 & 3 \\
n-octane & 4788 & 0.00400 & 2.00839 & 6.867 & 0.004 & 100 \\
toluene & 4788 & 0.01300 & 3.52165 & 9.077 & 0.004 & 11 \\
ethyl-benzene & 4788 & 0.00400 & 0.31613 & 0.931 & 0.004 & 918 \\
m\&p-xylene & 4788 & 0.00400 & 1.29156 & 3.123 & 0.004 & 851 \\
o-xylene & 4788 & 0.00400 & 0.45700 & 0.922 & 0.004 & 1330 \\
\end{longtable}

\begin{itemize}
\tightlist
\item
  STEP 2 processing continued: background correction
\item
  adjustments that were made according to paper: Gunnar's paper section
  2.2 and Guha 3.3
\item
  Check whether chemical has background noise level that needs to be
  removed
\item
  NO ADJUSTMENT if minimum value \textless{} 2xLOD and maximum value
  \textgreater{} 100xLOD
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{adjusting\_neg\_bg\_from\_lod }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(chemical, LOD, background, hourly\_data)\{ }
    \CommentTok{\# get min and max}
\NormalTok{    min\_value }\OtherTok{\textless{}{-}} \FunctionTok{min}\NormalTok{(hourly\_data[chemical], }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{    max\_value }\OtherTok{\textless{}{-}} \FunctionTok{max}\NormalTok{(hourly\_data[chemical], }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
    \CommentTok{\# if min less than double LOD or max \textgreater{} 100 times LOD}
    \CommentTok{\# adjust to {-}100 (for entire column???)}
    \ControlFlowTok{if}\NormalTok{ (min\_value }\SpecialCharTok{\textless{}} \DecValTok{2} \SpecialCharTok{*}\NormalTok{ LOD }\SpecialCharTok{\&}\NormalTok{ max\_value }\SpecialCharTok{\textgreater{}} \DecValTok{100} \SpecialCharTok{*}\NormalTok{ LOD )\{}
      \FunctionTok{return}\NormalTok{ (}\DecValTok{0}\NormalTok{)}
\NormalTok{    \}}
  \FunctionTok{return}\NormalTok{ (background)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Check if background is negligible for non voc
\item
  merge background and LOD
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{background\_lod\_non\_voc }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{chemical =}\NormalTok{ non\_vocs,}
                                 \AttributeTok{LOD =}\NormalTok{ LOD\_non\_voc,}
                                 \AttributeTok{background =} \FunctionTok{unname}\NormalTok{(background\_levels[non\_vocs]))}
\NormalTok{adjusted\_background\_non\_voc }\OtherTok{\textless{}{-}}\NormalTok{ background\_lod\_non\_voc }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rowwise}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{min =} \FunctionTok{min}\NormalTok{(hourly\_full\_nona[chemical], }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
         \AttributeTok{LODx2 =} \DecValTok{2} \SpecialCharTok{*}\NormalTok{ LOD,}
         \AttributeTok{criterion1 =} \FunctionTok{min}\NormalTok{(hourly\_full\_nona[chemical], }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\textless{}} \DecValTok{2} \SpecialCharTok{*}\NormalTok{ LOD,}
         \AttributeTok{max =} \FunctionTok{max}\NormalTok{(hourly\_full\_nona[chemical], }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
         \AttributeTok{LODx100 =} \DecValTok{100} \SpecialCharTok{*}\NormalTok{ LOD,}
         \AttributeTok{criterion2 =} \FunctionTok{max}\NormalTok{(hourly\_full\_nona[chemical], }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\textgreater{}} \DecValTok{100} \SpecialCharTok{*}\NormalTok{ LOD,}
         \AttributeTok{adjusted\_background =} \FunctionTok{adjusting\_neg\_bg\_from\_lod}\NormalTok{(chemical, LOD, background, }
\NormalTok{                                                         hourly\_full\_nona))}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Check if background is negligible for voc
\item
  merge background and LOD
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{background\_lod\_voc }\OtherTok{\textless{}{-}}\NormalTok{ LOD\_voc\_avg }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(}\FunctionTok{tibble}\NormalTok{(}\AttributeTok{chemical =} \FunctionTok{setdiff}\NormalTok{(}\FunctionTok{names}\NormalTok{(background\_levels), non\_vocs),}
                   \AttributeTok{background =}\NormalTok{ background\_levels[}\FunctionTok{setdiff}\NormalTok{(}\FunctionTok{names}\NormalTok{(background\_levels), }
\NormalTok{                                                          non\_vocs)]))}
\NormalTok{adjusted\_background\_voc }\OtherTok{\textless{}{-}}\NormalTok{ background\_lod\_voc }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rowwise}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{min =} \FunctionTok{min}\NormalTok{(hourly\_full\_nona[chemical], }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
         \AttributeTok{LODx2 =} \DecValTok{2} \SpecialCharTok{*}\NormalTok{ LOD,}
         \AttributeTok{criterion1 =} \FunctionTok{min}\NormalTok{(hourly\_full\_nona[chemical], }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\textless{}} \DecValTok{2} \SpecialCharTok{*}\NormalTok{ LOD,}
         \AttributeTok{max =} \FunctionTok{max}\NormalTok{(hourly\_full\_nona[chemical], }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
         \AttributeTok{LODx100 =} \DecValTok{100} \SpecialCharTok{*}\NormalTok{ LOD,}
         \AttributeTok{criterion2 =} \FunctionTok{max}\NormalTok{(hourly\_full\_nona[chemical], }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\textgreater{}} \DecValTok{100} \SpecialCharTok{*}\NormalTok{ LOD,}
         \AttributeTok{adjusted\_background =} \FunctionTok{adjusting\_neg\_bg\_from\_lod}\NormalTok{(chemical, LOD, background, }
\NormalTok{                                                         hourly\_full\_nona))}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  create dataset with background removed
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# So now we have the adjusted background concentrations}
\NormalTok{hourly\_nona\_bgrm }\OtherTok{\textless{}{-}}\NormalTok{ hourly\_full\_nona }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\FunctionTok{across}\NormalTok{(adjusted\_background\_non\_voc}\SpecialCharTok{$}\NormalTok{chemical, }
                \SpecialCharTok{\textasciitilde{}}\NormalTok{  .x }\SpecialCharTok{{-}}\NormalTok{ adjusted\_background\_non\_voc}\SpecialCharTok{$}\NormalTok{adjusted\_background[}
\NormalTok{                    adjusted\_background\_non\_voc}\SpecialCharTok{$}\NormalTok{chemical }\SpecialCharTok{==} \FunctionTok{cur\_column}\NormalTok{()]))}
\NormalTok{hourly\_nona\_bgrm }\OtherTok{\textless{}{-}}\NormalTok{ hourly\_nona\_bgrm }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\FunctionTok{across}\NormalTok{(adjusted\_background\_voc}\SpecialCharTok{$}\NormalTok{chemical, }
                \SpecialCharTok{\textasciitilde{}}\NormalTok{  .x }\SpecialCharTok{{-}}\NormalTok{ adjusted\_background\_voc}\SpecialCharTok{$}\NormalTok{adjusted\_background[}
\NormalTok{                    adjusted\_background\_voc}\SpecialCharTok{$}\NormalTok{chemical }\SpecialCharTok{==} \FunctionTok{cur\_column}\NormalTok{()]))}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  check number of 0 values per compound
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# look at zero values}
\FunctionTok{colSums}\NormalTok{(hourly\_nona\_bgrm }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           ch4           co2            co           h2s           so2 
##             1             1             1           829          3266 
##           nox            o3        ethane        ethene       propane 
##             0             0             1             0             1 
##       propene 1_3-butadiene      i-butane      n-butane     acetylene 
##             0          3357             1             1             0 
##  cyclopentane     i-pentane     n-pentane      n-hexane      isoprene 
##             0             1             1             2          2816 
##     n-heptane       benzene      n-octane       toluene ethyl-benzene 
##             0             0             0             0             0 
##    m&p-xylene      o-xylene 
##             0             0
\end{verbatim}

\paragraph{Step 3: Replace zero with random value between 0 and
0.5*LOD}\label{step-3-replace-zero-with-random-value-between-0-and-0.5lod}

\begin{itemize}
\tightlist
\item
  STEP 3: replace zero values with random values between 0 and 0.5xLOD
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{replace\_zero\_with\_random }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(column, name, LOD\_df)\{}
\NormalTok{  LOD }\OtherTok{\textless{}{-}}\NormalTok{ LOD\_df}\SpecialCharTok{$}\NormalTok{LOD[LOD\_df}\SpecialCharTok{$}\NormalTok{chemical }\SpecialCharTok{==}\NormalTok{ name]}
\NormalTok{  column }\OtherTok{\textless{}{-}} \FunctionTok{if\_else}\NormalTok{(column }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{runif}\NormalTok{(}\FunctionTok{length}\NormalTok{(column), }\DecValTok{0}\NormalTok{, }\FloatTok{0.5} \SpecialCharTok{*}\NormalTok{ LOD), }\DecValTok{3}\NormalTok{), column)}
  \FunctionTok{return}\NormalTok{ (column)}
\NormalTok{\}}

\NormalTok{hourly\_nona\_bgrm\_zerorepl }\OtherTok{\textless{}{-}}\NormalTok{ hourly\_nona\_bgrm }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\FunctionTok{across}\NormalTok{(adjusted\_background\_non\_voc}\SpecialCharTok{$}\NormalTok{chemical,}
                \SpecialCharTok{\textasciitilde{}} \FunctionTok{replace\_zero\_with\_random}\NormalTok{(.x, }\FunctionTok{cur\_column}\NormalTok{(), adjusted\_background\_non\_voc)))}

\NormalTok{hourly\_nona\_bgrm\_zerorepl }\OtherTok{\textless{}{-}}\NormalTok{ hourly\_nona\_bgrm\_zerorepl }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\FunctionTok{across}\NormalTok{(adjusted\_background\_voc}\SpecialCharTok{$}\NormalTok{chemical,}
                \SpecialCharTok{\textasciitilde{}} \FunctionTok{replace\_zero\_with\_random}\NormalTok{(.x, }\FunctionTok{cur\_column}\NormalTok{(), adjusted\_background\_voc)))}
\end{Highlighting}
\end{Shaded}

\paragraph{Step 4: Normalize}\label{step-4-normalize}

\begin{itemize}
\tightlist
\item
  STEP 4: Normalize the measurements
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#normalizing function}
\NormalTok{normalize\_column }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(column)\{}
\NormalTok{  background }\OtherTok{\textless{}{-}} \FunctionTok{quantile}\NormalTok{(column, }\DecValTok{0}\NormalTok{)}
\NormalTok{  max }\OtherTok{\textless{}{-}} \FunctionTok{quantile}\NormalTok{(column, }\DecValTok{1}\NormalTok{) }\CommentTok{\# this could be adjusted}
  \FunctionTok{return}\NormalTok{ ((column }\SpecialCharTok{{-}}\NormalTok{ background)}\SpecialCharTok{/}\NormalTok{(max }\SpecialCharTok{{-}}\NormalTok{ background))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# normalize all}
\NormalTok{hourly\_nona\_bgrm\_zerorepl\_norm }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(}\FunctionTok{sapply}\NormalTok{(}\FunctionTok{as.list}\NormalTok{(hourly\_nona\_bgrm\_zerorepl),}
\NormalTok{                                                   normalize\_column))}
\CommentTok{\#normalize the NON\_VOC}
\FunctionTok{summary}\NormalTok{(hourly\_nona\_bgrm\_zerorepl\_norm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       ch4               co2               co               h2s         
##  Min.   :0.00000   Min.   :0.0000   Min.   :0.00000   Min.   :0.00000  
##  1st Qu.:0.00579   1st Qu.:0.1384   1st Qu.:0.02592   1st Qu.:0.01022  
##  Median :0.01460   Median :0.1823   Median :0.03884   Median :0.02335  
##  Mean   :0.02683   Mean   :0.2000   Mean   :0.04761   Mean   :0.03501  
##  3rd Qu.:0.03720   3rd Qu.:0.2418   3rd Qu.:0.05970   3rd Qu.:0.04525  
##  Max.   :1.00000   Max.   :1.0000   Max.   :1.00000   Max.   :1.00000  
##       so2                nox                 o3              ethane        
##  Min.   :0.000000   Min.   :0.000000   Min.   :0.00000   Min.   :0.000000  
##  1st Qu.:0.007878   1st Qu.:0.006534   1st Qu.:0.09747   1st Qu.:0.008385  
##  Median :0.015994   Median :0.020262   Median :0.25487   Median :0.026671  
##  Mean   :0.026287   Mean   :0.036440   Mean   :0.26676   Mean   :0.050992  
##  3rd Qu.:0.023633   3rd Qu.:0.049978   3rd Qu.:0.40546   3rd Qu.:0.075375  
##  Max.   :1.000000   Max.   :1.000000   Max.   :1.00000   Max.   :1.000000  
##      ethene           propane            propene         1_3-butadiene     
##  Min.   :0.00000   Min.   :0.000000   Min.   :0.000000   Min.   :0.000000  
##  1st Qu.:0.01268   1st Qu.:0.009283   1st Qu.:0.005979   1st Qu.:0.002500  
##  Median :0.03547   Median :0.028409   Median :0.018482   Median :0.004167  
##  Mean   :0.05042   Mean   :0.053803   Mean   :0.028772   Mean   :0.007371  
##  3rd Qu.:0.07266   3rd Qu.:0.080130   3rd Qu.:0.042761   3rd Qu.:0.007500  
##  Max.   :1.00000   Max.   :1.000000   Max.   :1.000000   Max.   :1.000000  
##     i-butane          n-butane          acetylene        cyclopentane     
##  Min.   :0.00000   Min.   :0.000000   Min.   :0.00000   Min.   :0.000000  
##  1st Qu.:0.00614   1st Qu.:0.008777   1st Qu.:0.02674   1st Qu.:0.007432  
##  Median :0.01925   Median :0.027522   Median :0.05135   Median :0.022668  
##  Mean   :0.03837   Mean   :0.054900   Mean   :0.07436   Mean   :0.043730  
##  3rd Qu.:0.05369   3rd Qu.:0.077042   3rd Qu.:0.10211   3rd Qu.:0.062653  
##  Max.   :1.00000   Max.   :1.000000   Max.   :1.00000   Max.   :1.000000  
##    i-pentane          n-pentane           n-hexane           isoprene       
##  Min.   :0.000000   Min.   :0.000000   Min.   :0.000000   Min.   :0.000000  
##  1st Qu.:0.006303   1st Qu.:0.005681   1st Qu.:0.004703   1st Qu.:0.002801  
##  Median :0.019941   Median :0.018371   Median :0.016039   Median :0.005602  
##  Mean   :0.041094   Mean   :0.038859   Mean   :0.034979   Mean   :0.010315  
##  3rd Qu.:0.057857   3rd Qu.:0.054837   3rd Qu.:0.049544   3rd Qu.:0.011204  
##  Max.   :1.000000   Max.   :1.000000   Max.   :1.000000   Max.   :1.000000  
##    n-heptane           benzene           n-octane           toluene       
##  Min.   :0.000000   Min.   :0.00000   Min.   :0.000000   Min.   :0.00000  
##  1st Qu.:0.005473   1st Qu.:0.01637   1st Qu.:0.008269   1st Qu.:0.01389  
##  Median :0.018348   Median :0.04222   Median :0.026009   Median :0.04276  
##  Mean   :0.039328   Mean   :0.07655   Mean   :0.054341   Mean   :0.07825  
##  3rd Qu.:0.055866   3rd Qu.:0.10779   3rd Qu.:0.076497   3rd Qu.:0.11333  
##  Max.   :1.000000   Max.   :1.00000   Max.   :1.000000   Max.   :1.00000  
##  ethyl-benzene        m&p-xylene          o-xylene      
##  Min.   :0.000000   Min.   :0.000000   Min.   :0.00000  
##  1st Qu.:0.007551   1st Qu.:0.007374   1st Qu.:0.00000  
##  Median :0.034520   Median :0.039115   Median :0.04139  
##  Mean   :0.062378   Mean   :0.077508   Mean   :0.08650  
##  3rd Qu.:0.090615   3rd Qu.:0.115742   3rd Qu.:0.12881  
##  Max.   :1.000000   Max.   :1.000000   Max.   :1.00000
\end{verbatim}

\begin{itemize}
\tightlist
\item
  FINAL step: create matrix of processed and normalized concentrations
  for NMF
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{normalized\_matrix }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(hourly\_nona\_bgrm\_zerorepl\_norm)}
\CommentTok{\#important: using the normalized VOCs for this file}
\end{Highlighting}
\end{Shaded}

\section{NMF section}\label{nmf-section}

\subsection{Preprocess}\label{preprocess}

\subsubsection{Global variables}\label{global-variables}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{components }\OtherTok{\textless{}{-}} \DecValTok{4}\SpecialCharTok{:}\DecValTok{10}
\end{Highlighting}
\end{Shaded}

\subsubsection{Remove Ozone}\label{remove-ozone}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{normalized\_matrix\_less\_o3 }\OtherTok{\textless{}{-}}\NormalTok{ normalized\_matrix[ ,}\FunctionTok{setdiff}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(normalized\_matrix), }\StringTok{"o3"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\subsubsection{Compute error matrix}\label{compute-error-matrix}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# compute uncertainty matrix (inverse of weight?)}
\CommentTok{\# Based on the Guha paper}

\NormalTok{uncertainty\_matrix }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{0}\NormalTok{, }\AttributeTok{nrow =} \FunctionTok{nrow}\NormalTok{(normalized\_matrix\_less\_o3), }
                        \AttributeTok{ncol =} \FunctionTok{ncol}\NormalTok{(normalized\_matrix\_less\_o3))}
\NormalTok{LOD\_merged }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{chemical =} \FunctionTok{c}\NormalTok{(adjusted\_background\_non\_voc}\SpecialCharTok{$}\NormalTok{chemical, }
\NormalTok{                                  adjusted\_background\_voc}\SpecialCharTok{$}\NormalTok{chemical),}
                     \AttributeTok{LOD =} \FunctionTok{c}\NormalTok{(adjusted\_background\_non\_voc}\SpecialCharTok{$}\NormalTok{LOD, }
\NormalTok{                             adjusted\_background\_voc}\SpecialCharTok{$}\NormalTok{LOD))}

\NormalTok{LOD\_merged }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{chemical =} \FunctionTok{names}\NormalTok{(hourly\_nona\_bgrm\_zerorepl\_norm)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(LOD\_merged) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(chemical }\SpecialCharTok{\%in\%} \FunctionTok{colnames}\NormalTok{(normalized\_matrix\_less\_o3))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Joining with `by = join_by(chemical)`
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# creating uncertainty Matrix}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{dim}\NormalTok{(uncertainty\_matrix)[}\DecValTok{1}\NormalTok{]) \{ }
  \ControlFlowTok{for}\NormalTok{ (j }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{dim}\NormalTok{(uncertainty\_matrix)[}\DecValTok{2}\NormalTok{]) \{}
\NormalTok{    chemical }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(normalized\_matrix\_less\_o3)[j]}
\NormalTok{    xij }\OtherTok{\textless{}{-}}\NormalTok{ normalized\_matrix\_less\_o3[i, j]}
\NormalTok{    LOD }\OtherTok{\textless{}{-}}\NormalTok{ LOD\_merged}\SpecialCharTok{$}\NormalTok{LOD[LOD\_merged}\SpecialCharTok{$}\NormalTok{chemical }\SpecialCharTok{==}\NormalTok{ chemical]}
    \CommentTok{\# Get LOD value for this row }
    \ControlFlowTok{if}\NormalTok{ (j }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) \{ }
      \CommentTok{\# based on equation 6, we sqrt ch4 (at column = 1) and times by 1}
\NormalTok{      uncertainty\_matrix[i, j] }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{(xij)}
\NormalTok{    \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (j }\SpecialCharTok{==} \DecValTok{2}\NormalTok{) \{}
      \CommentTok{\# 0.25 for co2 }
\NormalTok{      uncertainty\_matrix[i, j] }\OtherTok{\textless{}{-}} \FloatTok{0.25} \SpecialCharTok{*} \FunctionTok{sqrt}\NormalTok{(xij)}
\NormalTok{    \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (j }\SpecialCharTok{==} \DecValTok{3}\NormalTok{) \{ }
      \CommentTok{\# 0.5 for CO}
\NormalTok{      uncertainty\_matrix[i, j] }\OtherTok{\textless{}{-}} \FloatTok{0.5} \SpecialCharTok{*} \FunctionTok{sqrt}\NormalTok{(xij)}
\NormalTok{    \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (xij }\SpecialCharTok{\textless{}=}\NormalTok{ LOD) \{}
\NormalTok{      uncertainty\_matrix[i, j] }\OtherTok{\textless{}{-}} \DecValTok{2} \SpecialCharTok{*}\NormalTok{ LOD }\CommentTok{\# equation 5a) in reference paper}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      uncertainty\_matrix[i, j] }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{(((}\FloatTok{0.1} \SpecialCharTok{*}\NormalTok{ xij)}\SpecialCharTok{**}\DecValTok{2} \SpecialCharTok{+}\NormalTok{ LOD}\SpecialCharTok{**}\DecValTok{2}\NormalTok{))  }\CommentTok{\#equation 5c) in reference paper}
\NormalTok{    \}}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert zero uncertainties to the next smallest uncertainty of the corresponding compound}
\NormalTok{uncertainty\_matrix[uncertainty\_matrix}\SpecialCharTok{==}\DecValTok{0}\NormalTok{]}\OtherTok{\textless{}{-}}\FunctionTok{apply}\NormalTok{(uncertainty\_matrix, }\DecValTok{2}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{sort}\NormalTok{(x)[}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in uncertainty_matrix[uncertainty_matrix == 0] <-
## apply(uncertainty_matrix, : number of items to replace is not a multiple of
## replacement length
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# THIS NEEDS TO BE CHECKED IF WE WANT TO TAKE RECIPROCAL FOR EACH ELEMENT}
\CommentTok{\# CURRENT RESULTS IS WHEN WEIGHT = UNCERTAINTY}
\CommentTok{\# NOT POSSIBLE TO DO SIMPLY TAKE RECIPROCAL SINCE THERE\textquotesingle{}RE 0 UNCERTAINTIES}
\NormalTok{weight\_matrix }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{/}\NormalTok{uncertainty\_matrix }

\FunctionTok{summary}\NormalTok{(weight\_matrix)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        V1                V2               V3                V4       
##  Min.   :  1.000   Min.   : 4.000   Min.   :  2.000   Min.   :1.250  
##  1st Qu.:  5.185   1st Qu.: 8.134   1st Qu.:  8.185   1st Qu.:1.250  
##  Median :  8.277   Median : 9.369   Median : 10.148   Median :1.250  
##  Mean   : 10.323   Mean   : 9.623   Mean   : 10.640   Mean   :1.251  
##  3rd Qu.: 13.141   3rd Qu.:10.751   3rd Qu.: 12.422   3rd Qu.:1.250  
##  Max.   :491.144   Max.   :34.037   Max.   :126.797   Max.   :2.484  
##        V5              V6               V7               V8        
##  Min.   :1.250   Min.   : 8.944   Min.   : 9.678   Min.   : 9.746  
##  1st Qu.:1.250   1st Qu.:10.000   1st Qu.:19.231   1st Qu.:21.739  
##  Median :1.250   Median :10.000   Median :23.293   Median :39.121  
##  Mean   :1.253   Mean   :12.384   Mean   :27.649   Mean   :33.580  
##  3rd Qu.:1.250   3rd Qu.:10.000   3rd Qu.:36.985   3rd Qu.:42.365  
##  Max.   :2.488   Max.   :19.900   Max.   :38.271   Max.   :43.261  
##        V9              V10              V11              V12        
##  Min.   : 9.859   Min.   : 9.842   Min.   : 9.903   Min.   : 9.903  
##  1st Qu.:29.412   1st Qu.:27.778   1st Qu.:35.714   1st Qu.:35.714  
##  Median :46.347   Median :44.285   Median :35.714   Median :54.768  
##  Mean   :43.621   Mean   :40.618   Mean   :40.512   Mean   :52.185  
##  3rd Qu.:56.564   3rd Qu.:54.112   3rd Qu.:35.714   3rd Qu.:68.687  
##  Max.   :58.528   Max.   :55.276   Max.   :71.066   Max.   :71.074  
##       V13              V14              V15              V16       
##  Min.   : 9.917   Min.   : 9.187   Min.   : 9.917   Min.   : 9.95  
##  1st Qu.:38.462   1st Qu.:11.628   1st Qu.:38.462   1st Qu.:50.00  
##  Median :59.325   Median :21.253   Median :60.265   Median :75.75  
##  Mean   :56.622   Mean   :17.687   Mean   :56.700   Mean   :73.01  
##  3rd Qu.:73.720   3rd Qu.:22.820   3rd Qu.:73.711   3rd Qu.:95.52  
##  Max.   :76.540   Max.   :23.140   Max.   :76.541   Max.   :99.50  
##       V17             V18              V19             V20         
##  Min.   : 9.95   Min.   :  9.96   Min.   : 9.94   Min.   :  9.968  
##  1st Qu.:50.00   1st Qu.: 55.56   1st Qu.:45.45   1st Qu.: 62.500  
##  Median :74.81   Median : 80.74   Median :45.45   Median : 89.534  
##  Mean   :72.66   Mean   : 80.01   Mean   :59.24   Mean   : 89.780  
##  3rd Qu.:95.23   3rd Qu.:105.43   3rd Qu.:89.08   3rd Qu.:118.592  
##  Max.   :99.50   Max.   :110.56   Max.   :90.44   Max.   :124.378  
##       V21              V22               V23               V24         
##  Min.   :  9.96   Min.   :  9.968   Min.   :  9.968   Min.   :  9.968  
##  1st Qu.: 55.56   1st Qu.: 62.500   1st Qu.: 62.500   1st Qu.: 62.500  
##  Median : 85.48   Median : 91.169   Median : 88.561   Median : 81.631  
##  Mean   : 80.33   Mean   : 89.312   Mean   : 86.618   Mean   : 85.245  
##  3rd Qu.:105.73   3rd Qu.:119.159   3rd Qu.:118.236   3rd Qu.:114.204  
##  Max.   :110.55   Max.   :124.377   Max.   :124.373   Max.   :124.279  
##       V25               V26         
##  Min.   :  9.968   Min.   :  9.968  
##  1st Qu.: 62.500   1st Qu.: 62.500  
##  Median : 69.955   Median : 62.500  
##  Mean   : 80.748   Mean   : 73.996  
##  3rd Qu.:111.760   3rd Qu.: 98.097  
##  Max.   :124.377   Max.   :124.265
\end{verbatim}

\subsubsection{Helper functions for
plots}\label{helper-functions-for-plots}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{get\_fingerprint\_plot }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(H, }\AttributeTok{factor\_names =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Factor 1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Factor 2\textquotesingle{}}\NormalTok{,}
                                                     \StringTok{\textquotesingle{}Factor 3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Factor 4\textquotesingle{}}\NormalTok{,}
                                                     \StringTok{\textquotesingle{}Factor 5\textquotesingle{}}\NormalTok{))\{}
\NormalTok{  custom\_colors }\OtherTok{\textless{}{-}} \FunctionTok{setNames}\NormalTok{(color\_pal,}
\NormalTok{                            factor\_names)}

  \CommentTok{\# Convert to proportions}
\NormalTok{  contrib\_prop }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(H[,}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{length}\NormalTok{(H)}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)], }\AttributeTok{MARGIN =} \DecValTok{2}\NormalTok{, }
                        \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(x) \{x}\SpecialCharTok{/}\FunctionTok{sum}\NormalTok{(x)\})}
  
\NormalTok{  contrib\_prop }\OtherTok{\textless{}{-}}\NormalTok{ contrib\_prop }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{as\_tibble}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Component =}\NormalTok{ factor\_names) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Component =} \FunctionTok{factor}\NormalTok{(Component, }\AttributeTok{levels =}\NormalTok{ factor\_names)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \SpecialCharTok{{-}}\NormalTok{Component,}
                 \AttributeTok{names\_to =} \StringTok{"Chemical"}\NormalTok{,}
                 \AttributeTok{values\_to =} \StringTok{"Contribution\_prop"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Chemical =} \FunctionTok{factor}\NormalTok{(Chemical, }\AttributeTok{levels =}\NormalTok{ desired\_order))}
    
  \FunctionTok{return}\NormalTok{(contrib\_prop }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ Component, }\AttributeTok{y =}\NormalTok{ Contribution\_prop, }\AttributeTok{x =}\NormalTok{ Chemical)) }\SpecialCharTok{+}
    \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{position =} \StringTok{"fill"}\NormalTok{, }\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ custom\_colors) }\SpecialCharTok{+}
    \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{"Chemical"}\NormalTok{, }\AttributeTok{y =} \StringTok{"Contribution Proportion"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{theme}\NormalTok{(}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
      \AttributeTok{panel.background =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{    ))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hourly\_wind\_nona }\OtherTok{\textless{}{-}}\NormalTok{ hourly\_nona }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(wdr\_deg, wsp\_ms)}

\NormalTok{get\_wind\_plot\_data }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(W, }\AttributeTok{factor\_names =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Factor 1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Factor 2\textquotesingle{}}\NormalTok{,}
                                                     \StringTok{\textquotesingle{}Factor 3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Factor 4\textquotesingle{}}\NormalTok{,}
                                                     \StringTok{\textquotesingle{}Factor 5\textquotesingle{}}\NormalTok{))\{}
\NormalTok{  data\_to\_plot }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
    \AttributeTok{component1 =}\NormalTok{ W[, }\DecValTok{1}\NormalTok{],}
    \AttributeTok{component2 =}\NormalTok{ W[, }\DecValTok{2}\NormalTok{],}
    \AttributeTok{component3 =}\NormalTok{ W[, }\DecValTok{3}\NormalTok{],}
    \AttributeTok{component4 =}\NormalTok{ W[, }\DecValTok{4}\NormalTok{],}
    \AttributeTok{component5 =}\NormalTok{ W[, }\DecValTok{5}\NormalTok{],}
    \AttributeTok{wd =} \FunctionTok{round}\NormalTok{(hourly\_wind\_nona}\SpecialCharTok{$}\NormalTok{wdr\_deg, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}
\NormalTok{  )}
  
\NormalTok{  data\_long }\OtherTok{\textless{}{-}}\NormalTok{ data\_to\_plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \FunctionTok{starts\_with}\NormalTok{(}\StringTok{"component"}\NormalTok{), }\AttributeTok{names\_to =} \StringTok{"Factor"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"Expression"}\NormalTok{)}
  
\NormalTok{  data\_long }\OtherTok{\textless{}{-}}\NormalTok{ data\_long }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{wd =} \FunctionTok{factor}\NormalTok{(wd, }\AttributeTok{levels =} \FunctionTok{sort}\NormalTok{(}\FunctionTok{unique}\NormalTok{(wd))))  }
    
\NormalTok{  data\_long}
\NormalTok{\}}

\NormalTok{get\_wind\_plots }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(W, }\AttributeTok{y\_axis\_upper =} \FunctionTok{rep}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{5}\NormalTok{),}
                               \AttributeTok{factor\_names =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Factor 1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Factor 2\textquotesingle{}}\NormalTok{,}
                                                     \StringTok{\textquotesingle{}Factor 3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Factor 4\textquotesingle{}}\NormalTok{,}
                                                     \StringTok{\textquotesingle{}Factor 5\textquotesingle{}}\NormalTok{))\{}
\NormalTok{  data\_long }\OtherTok{\textless{}{-}} \FunctionTok{get\_wind\_plot\_data}\NormalTok{(W, factor\_names)}
  
  \CommentTok{\# Select every second wind direction for labeling}
\NormalTok{  every\_second\_label }\OtherTok{\textless{}{-}} \FunctionTok{levels}\NormalTok{(data\_long}\SpecialCharTok{$}\NormalTok{wd)[}\FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{length}\NormalTok{(}\FunctionTok{levels}\NormalTok{(data\_long}\SpecialCharTok{$}\NormalTok{wd)), }\AttributeTok{by =} \DecValTok{2}\NormalTok{)]}
  
\NormalTok{  factor\_labels }\OtherTok{\textless{}{-}} \FunctionTok{setNames}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Factor 1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Factor 2\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Factor 3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Factor 4\textquotesingle{}}\NormalTok{,}
                                    \StringTok{\textquotesingle{}Factor 5\textquotesingle{}}\NormalTok{), }\StringTok{\textquotesingle{} {-} \textquotesingle{}}\NormalTok{, factor\_names), }\FunctionTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}component\textquotesingle{}}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{))}
    
\NormalTok{  y\_axis\_limits }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
    \StringTok{"component1"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, y\_axis\_upper[}\DecValTok{1}\NormalTok{]),}
    \StringTok{"component2"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, y\_axis\_upper[}\DecValTok{2}\NormalTok{]),}
    \StringTok{"component3"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, y\_axis\_upper[}\DecValTok{3}\NormalTok{]),}
    \StringTok{"component4"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, y\_axis\_upper[}\DecValTok{4}\NormalTok{]),}
    \StringTok{"component5"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, y\_axis\_upper[}\DecValTok{5}\NormalTok{])}
\NormalTok{  )}


\NormalTok{  plots }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(i) \{}
\NormalTok{    factor\_name }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"component"}\NormalTok{, i)}
    
    \FunctionTok{ggplot}\NormalTok{(data\_long }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(Factor }\SpecialCharTok{==}\NormalTok{ factor\_name), }
           \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ wd, }\AttributeTok{y =}\NormalTok{ Expression, }\AttributeTok{fill =} \FunctionTok{as.factor}\NormalTok{(wd))) }\SpecialCharTok{+}
      \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{outliers=}\NormalTok{F, }\AttributeTok{size=}\FloatTok{0.3}\NormalTok{) }\SpecialCharTok{+}  
      \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{rep}\NormalTok{(color\_pal[i], }\FunctionTok{length}\NormalTok{(}\FunctionTok{unique}\NormalTok{(data\_long}\SpecialCharTok{$}\NormalTok{wd)))) }\SpecialCharTok{+}  
      \FunctionTok{scale\_x\_discrete}\NormalTok{(}\AttributeTok{breaks =}\NormalTok{ every\_second\_label) }\SpecialCharTok{+}  
      \FunctionTok{coord\_cartesian}\NormalTok{(}\AttributeTok{ylim =}\NormalTok{ y\_axis\_limits[[factor\_name]]) }\SpecialCharTok{+} 
      \FunctionTok{scale\_y\_continuous}\NormalTok{(}
        \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\ConstantTok{NA}\NormalTok{),}
        \AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, y\_axis\_limits[[factor\_name]][}\DecValTok{2}\NormalTok{], }\AttributeTok{length.out =} \DecValTok{5}\NormalTok{) ,}
        \AttributeTok{expand=}\FunctionTok{expansion}\NormalTok{(}\AttributeTok{mult=}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{))}
\NormalTok{      ) }\SpecialCharTok{+}
      \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =}\NormalTok{ factor\_labels[factor\_name], }
           \AttributeTok{x =} \StringTok{"Wind Direction (°)"}\NormalTok{, }
           \AttributeTok{y =} \StringTok{"Factor Expression"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{theme}\NormalTok{(}
        \AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{,}
        \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{6}\NormalTok{),  }\CommentTok{\# Smaller title text}
        \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{6}\NormalTok{),  }\CommentTok{\# Smaller axis labels}
        \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{6}\NormalTok{),  }\CommentTok{\# Smaller x and y tick labels}
        \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{)}
\NormalTok{      )}
\NormalTok{  \})}
  
  
  \FunctionTok{grid.arrange}\NormalTok{(}\AttributeTok{grobs =}\NormalTok{ plots, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\subsection{LS-NMF + Random seed}\label{ls-nmf-random-seed}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# for each rank, run 30 models and find best one}
\CommentTok{\# start\_time\_lsnmf\_rand \textless{}{-} Sys.time()}
\CommentTok{\# }
\CommentTok{\# lsnmf\_random\_less\_o3 \textless{}{-} nmf(}
\CommentTok{\#   normalized\_matrix\_less\_o3,}
\CommentTok{\#   components,}
\CommentTok{\#   method = "ls{-}nmf",}
\CommentTok{\#   weight = weight\_matrix,}
\CommentTok{\#   30,}
\CommentTok{\#   seed = 123456}
\CommentTok{\# )}
\CommentTok{\# }
\CommentTok{\# end\_time\_lsnmf\_rand \textless{}{-} Sys.time()}
\CommentTok{\# end\_time\_lsnmf\_rand{-}start\_time\_lsnmf\_rand}
\CommentTok{\# \# 19.25 minutes to run the above}

\CommentTok{\# saveRDS(lsnmf\_random\_less\_o3,}
\CommentTok{\#         \textquotesingle{}lsnmf\_random\_less\_o3.rds\textquotesingle{})}
\NormalTok{lsnmf\_random\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{readRDS}\NormalTok{(}\StringTok{\textquotesingle{}lsnmf\_random\_less\_o3.rds\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# plots the NMF rank survey}
\FunctionTok{plot}\NormalTok{(lsnmf\_random\_less\_o3)}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-31-1.pdf}

\subsubsection{Look at 5 factors:}\label{look-at-5-factors}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{output }\OtherTok{\textless{}{-}}\NormalTok{ lsnmf\_random\_less\_o3}\SpecialCharTok{$}\NormalTok{fit}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{5}\StringTok{\textasciigrave{}}
\NormalTok{W }\OtherTok{\textless{}{-}} \FunctionTok{basis}\NormalTok{(output)}
\NormalTok{H }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(output)}
\end{Highlighting}
\end{Shaded}

\paragraph{Source Contribution plots}\label{source-contribution-plots}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert H to a data frame for ggplot}
\NormalTok{H\_df\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(H)}
\CommentTok{\# Add a column for chemicals}
\NormalTok{H\_df\_5c\_less\_o3}\SpecialCharTok{$}\NormalTok{Component }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(H\_df\_5c\_less\_o3)}

\CommentTok{\# Reshape data to long format}
\NormalTok{H\_long\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{pivot\_longer}\NormalTok{(H\_df\_5c\_less\_o3, }\AttributeTok{cols =} \SpecialCharTok{{-}}\NormalTok{Component, }
                                  \AttributeTok{names\_to =} \StringTok{"Chemical"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"Contribution"}\NormalTok{)}

\CommentTok{\# Plot}
\NormalTok{nmfplt\_1\_lsnmf\_random\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}1)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_2\_lsnmf\_random\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_3\_lsnmf\_random\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}3)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_4\_lsnmf\_random\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}4\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}4)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_5\_lsnmf\_random\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}5\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}5)\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-34-1.pdf}

\paragraph{Fingerprint plot}\label{fingerprint-plot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fingerprint }\OtherTok{\textless{}{-}} \FunctionTok{get\_fingerprint\_plot}\NormalTok{(H\_df\_5c\_less\_o3, }\FunctionTok{c}\NormalTok{(}
      \StringTok{\textquotesingle{}Traffic\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Combustion\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Oil \& Gas Emissions\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Flare (factor 4)\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Flare (factor 5)\textquotesingle{}}
\NormalTok{    ))}

\NormalTok{fingerprint}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-35-1.pdf}

\paragraph{Wind plot}\label{wind-plot}

\newline

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wind\_plot }\OtherTok{\textless{}{-}} \FunctionTok{get\_wind\_plots}\NormalTok{(W, }\AttributeTok{y\_axis\_upper =} \FunctionTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{2}\NormalTok{, }\FloatTok{3.5}\NormalTok{, }\FloatTok{3.5}\NormalTok{, }\FloatTok{4.5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-36-1.pdf}

\subsection{LS-NMF + nndsvd seed}\label{ls-nmf-nndsvd-seed}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Run nmf with 4:10 components and nndsvd seed}
\CommentTok{\# start\_time\_lsnmf\_nndsvd \textless{}{-} Sys.time()}
\CommentTok{\# }
\CommentTok{\# lsnmf\_nndsvd\_less\_o3 \textless{}{-} nmf(}
\CommentTok{\#   normalized\_matrix\_less\_o3,}
\CommentTok{\#   rank = components,}
\CommentTok{\#   nrun = 1, \# since using nndsvd}
\CommentTok{\#   method = "ls{-}nmf",}
\CommentTok{\#   weight = weight\_matrix,}
\CommentTok{\#   seed = \textquotesingle{}nndsvd\textquotesingle{}}
\CommentTok{\# )}
\CommentTok{\# }
\CommentTok{\# end\_time\_lsnmf\_nndsvd \textless{}{-} Sys.time()}
\CommentTok{\# end\_time\_lsnmf\_nndsvd{-}start\_time\_lsnmf\_nndsvd}
\CommentTok{\# \# \# 1.34 minutes to run the above}
\CommentTok{\# \# }
\CommentTok{\# saveRDS(lsnmf\_nndsvd\_less\_o3,}
\CommentTok{\#         \textquotesingle{}lsnmf\_nndsvd\_less\_o3.rds\textquotesingle{})}

\NormalTok{lsnmf\_nndsvd\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{readRDS}\NormalTok{(}\StringTok{\textquotesingle{}lsnmf\_nndsvd\_less\_o3.rds\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# plots the NMF rank survey}
\FunctionTok{plot}\NormalTok{(lsnmf\_nndsvd\_less\_o3)}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-38-1.pdf}

\subsubsection{Look at 5 factors:}\label{look-at-5-factors-1}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{output }\OtherTok{\textless{}{-}}\NormalTok{ lsnmf\_nndsvd\_less\_o3}\SpecialCharTok{$}\NormalTok{fit}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{5}\StringTok{\textasciigrave{}}
\NormalTok{W }\OtherTok{\textless{}{-}} \FunctionTok{basis}\NormalTok{(output)}
\NormalTok{H }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(output)}
\end{Highlighting}
\end{Shaded}

\paragraph{Source Contribution plots}\label{source-contribution-plots-1}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert H to a data frame for ggplot}
\NormalTok{H\_df\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(H)}
\CommentTok{\# Add a column for chemicals}
\NormalTok{H\_df\_5c\_less\_o3}\SpecialCharTok{$}\NormalTok{Component }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(H\_df\_5c\_less\_o3)}

\CommentTok{\# Reshape data to long format}
\NormalTok{H\_long\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{pivot\_longer}\NormalTok{(H\_df\_5c\_less\_o3, }\AttributeTok{cols =} \SpecialCharTok{{-}}\NormalTok{Component, }
                                  \AttributeTok{names\_to =} \StringTok{"Chemical"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"Contribution"}\NormalTok{)}

\CommentTok{\# Plot}
\NormalTok{nmfplt\_1\_lsnmf\_nndsvd\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}1)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_2\_lsnmf\_nndsvd\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_3\_lsnmf\_nndsvd\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}3)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_4\_lsnmf\_nndsvd\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}4\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}4)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_5\_lsnmf\_nndsvd\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}5\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}5)\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-41-1.pdf}

\paragraph{Fingerprint plot}\label{fingerprint-plot-1}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fingerprint }\OtherTok{\textless{}{-}} \FunctionTok{get\_fingerprint\_plot}\NormalTok{(H\_df\_5c\_less\_o3, }\FunctionTok{c}\NormalTok{(}
      \StringTok{\textquotesingle{}Traffic\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Combustion\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Oil \& Gas Emissions\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Flare (factor 4)\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Flare (factor 5)\textquotesingle{}}
\NormalTok{    ))}
\NormalTok{fingerprint}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-42-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#ggsave("fingerprint.png", c)}
\end{Highlighting}
\end{Shaded}

\paragraph{Wind plot}\label{wind-plot-1}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wind\_plot }\OtherTok{\textless{}{-}} \FunctionTok{get\_wind\_plots}\NormalTok{(W, }\AttributeTok{y\_axis\_upper =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.25}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.18}\NormalTok{, }\FloatTok{0.15}\NormalTok{, }\FloatTok{0.15}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-43-1.pdf}

\subsection{Comparing random seed vs nndsvd for
ls-nmf}\label{comparing-random-seed-vs-nndsvd-for-ls-nmf}

Residuals is defined as sum(((X - fitted(object)) * weight)\^{}2)/2

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tibble}\NormalTok{(}\AttributeTok{component =}\NormalTok{ components,}
       \AttributeTok{random\_residual =}\NormalTok{ lsnmf\_random\_less\_o3}\SpecialCharTok{$}\NormalTok{measures}\SpecialCharTok{$}\NormalTok{residuals,}
       \AttributeTok{nndsvd\_residual =}\NormalTok{ lsnmf\_nndsvd\_less\_o3}\SpecialCharTok{$}\NormalTok{measures}\SpecialCharTok{$}\NormalTok{residuals) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ component, }\AttributeTok{y =}\NormalTok{random\_residual, }\AttributeTok{color =} \StringTok{\textquotesingle{}Random seed\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ component, }\AttributeTok{y =}\NormalTok{random\_residual, }\AttributeTok{color =} \StringTok{\textquotesingle{}Random seed\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ component, }\AttributeTok{y =}\NormalTok{ nndsvd\_residual, }\AttributeTok{color =} \StringTok{\textquotesingle{}nndsvd\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ component, }\AttributeTok{y =}\NormalTok{ nndsvd\_residual, }\AttributeTok{color =} \StringTok{\textquotesingle{}nndsvd\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_colour\_manual}\NormalTok{(}\StringTok{""}\NormalTok{, }
                    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"Random seed"}\NormalTok{, }\StringTok{"nndsvd"}\NormalTok{),}
                    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"tomato1"}\NormalTok{, }\StringTok{"dodgerblue"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{\textquotesingle{}Rank\textquotesingle{}}\NormalTok{, }\AttributeTok{y =} \StringTok{\textquotesingle{}Residual\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}WRSS\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-44-1.pdf}

\subsection{KL + Random seed}\label{kl-random-seed}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# start\_time\_kl\_random \textless{}{-} Sys.time()}
\CommentTok{\# }
\CommentTok{\# kl\_random\_less\_o3 \textless{}{-} nmf(}
\CommentTok{\#   normalized\_matrix\_less\_o3,}
\CommentTok{\#   rank = components,}
\CommentTok{\#   nrun = 30,}
\CommentTok{\#   method = "KL",}
\CommentTok{\#   seed = 123456}
\CommentTok{\# )}
\CommentTok{\# }
\CommentTok{\# end\_time\_kl\_random \textless{}{-} Sys.time()}
\CommentTok{\# end\_time\_kl\_random{-}start\_time\_kl\_random}
\CommentTok{\# 14.27 minutes to run the above}

\CommentTok{\# saveRDS(kl\_random\_less\_o3, \textquotesingle{}kl\_random\_less\_o3.rds\textquotesingle{})}

\NormalTok{kl\_random\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{readRDS}\NormalTok{(}\StringTok{\textquotesingle{}kl\_random\_less\_o3.rds\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# plots the NMF rank survey}
\FunctionTok{plot}\NormalTok{(kl\_random\_less\_o3)}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-46-1.pdf}
\#\#\# Look at 5 factors:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{output }\OtherTok{\textless{}{-}}\NormalTok{ kl\_random\_less\_o3}\SpecialCharTok{$}\NormalTok{fit}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{5}\StringTok{\textasciigrave{}}
\NormalTok{W }\OtherTok{\textless{}{-}} \FunctionTok{basis}\NormalTok{(output)}
\NormalTok{H }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(output)}
\end{Highlighting}
\end{Shaded}

\paragraph{Source Contribution plots}\label{source-contribution-plots-2}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert H to a data frame for ggplot}
\NormalTok{H\_df\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(H)}
\CommentTok{\# Add a column for chemicals}
\NormalTok{H\_df\_5c\_less\_o3}\SpecialCharTok{$}\NormalTok{Component }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(H\_df\_5c\_less\_o3)}

\CommentTok{\# Reshape data to long format}
\NormalTok{H\_long\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{pivot\_longer}\NormalTok{(H\_df\_5c\_less\_o3, }\AttributeTok{cols =} \SpecialCharTok{{-}}\NormalTok{Component, }
                                  \AttributeTok{names\_to =} \StringTok{"Chemical"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"Contribution"}\NormalTok{)}

\CommentTok{\# Plot}
\NormalTok{nmfplt\_1\_kl\_random\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}1)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_2\_kl\_random\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_3\_kl\_random\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}3)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_4\_kl\_random\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}4\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}4)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_5\_kl\_random\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}5\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}5)\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-49-1.pdf}

\paragraph{Fingerprint plot}\label{fingerprint-plot-2}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fingerprint }\OtherTok{\textless{}{-}} \FunctionTok{get\_fingerprint\_plot}\NormalTok{(H\_df\_5c\_less\_o3, }\FunctionTok{c}\NormalTok{(}
      \StringTok{\textquotesingle{}Traffic\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Combustion\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Oil \& Gas Emissions\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Flare (factor 4)\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Flare (factor 5)\textquotesingle{}}
\NormalTok{    ))}
\NormalTok{fingerprint}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-50-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#ggsave("fingerprint.png", c)}
\end{Highlighting}
\end{Shaded}

\paragraph{Wind plot}\label{wind-plot-2}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wind\_plot }\OtherTok{\textless{}{-}} \FunctionTok{get\_wind\_plots}\NormalTok{(W, }\AttributeTok{y\_axis\_upper =} \FunctionTok{c}\NormalTok{(}\FloatTok{4.5}\NormalTok{, }\FloatTok{1.8}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-51-1.pdf}

\subsection{KL + nndsvd}\label{kl-nndsvd}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# errors \textless{}{-} numeric(length(components) {-} 4)}

\CommentTok{\# Loop over the number of components}
\CommentTok{\# for (n in components) \{}
\CommentTok{\#   nmf\_result \textless{}{-} nmf(normalized\_matrix\_less\_o3, rank = n, method = "KL", seed=\textquotesingle{}nndsvd\textquotesingle{})}
\CommentTok{\#   reconstruction \textless{}{-} basis(nmf\_result) \%*\% coef(nmf\_result)}
\CommentTok{\#   error \textless{}{-} norm(normalized\_matrix\_less\_o3 {-} reconstruction, type = "F")\^{}2 \# RSS}
\CommentTok{\#   errors[n{-}3] \textless{}{-} error}
\CommentTok{\#   print(paste0(\textquotesingle{}Completed \textquotesingle{}, n {-} 3, \textquotesingle{} out of 7\textquotesingle{}))}
\CommentTok{\# \}}
\CommentTok{\# }
\CommentTok{\# saveRDS(errors, \textquotesingle{}errors\_KL\_nndsvd\_less\_o3.rds\textquotesingle{})}
\CommentTok{\# }
\CommentTok{\# errors \textless{}{-} readRDS(\textquotesingle{}errors\_KL\_nndsvd\_less\_o3.rds\textquotesingle{})}

\CommentTok{\# start\_time\_kl\_nndsvd \textless{}{-} Sys.time()}
\CommentTok{\# }
\CommentTok{\# kl\_nndsvd\_less\_o3 \textless{}{-} nmf(}
\CommentTok{\#   normalized\_matrix\_less\_o3,}
\CommentTok{\#   rank = components,}
\CommentTok{\#   nrun = 1,}
\CommentTok{\#   method = "KL",}
\CommentTok{\#   seed = \textquotesingle{}nndsvd\textquotesingle{}}
\CommentTok{\# )}
\CommentTok{\# }
\CommentTok{\# end\_time\_kl\_nndsvd \textless{}{-} Sys.time()}
\CommentTok{\# end\_time\_kl\_nndsvd{-}start\_time\_kl\_nndsvd}
\CommentTok{\# 1 minute to run the above}

\CommentTok{\# saveRDS(kl\_nndsvd\_less\_o3, \textquotesingle{}kl\_nndsvd\_less\_o3.rds\textquotesingle{})}

\NormalTok{kl\_nndsvd\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{readRDS}\NormalTok{(}\StringTok{\textquotesingle{}kl\_nndsvd\_less\_o3.rds\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# plots the NMF rank survey}
\FunctionTok{plot}\NormalTok{(kl\_nndsvd\_less\_o3)}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-53-1.pdf}

\subsubsection{Look at 5 factors:}\label{look-at-5-factors-2}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{output }\OtherTok{\textless{}{-}}\NormalTok{ kl\_nndsvd\_less\_o3}\SpecialCharTok{$}\NormalTok{fit}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{5}\StringTok{\textasciigrave{}}
\NormalTok{W }\OtherTok{\textless{}{-}} \FunctionTok{basis}\NormalTok{(output)}
\NormalTok{H }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(output)}
\end{Highlighting}
\end{Shaded}

\paragraph{Source Contribution plots}\label{source-contribution-plots-3}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert H to a data frame for ggplot}
\NormalTok{H\_df\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(H)}
\CommentTok{\# Add a column for chemicals}
\NormalTok{H\_df\_5c\_less\_o3}\SpecialCharTok{$}\NormalTok{Component }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(H\_df\_5c\_less\_o3)}

\CommentTok{\# Reshape data to long format}
\NormalTok{H\_long\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{pivot\_longer}\NormalTok{(H\_df\_5c\_less\_o3, }\AttributeTok{cols =} \SpecialCharTok{{-}}\NormalTok{Component, }
                                  \AttributeTok{names\_to =} \StringTok{"Chemical"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"Contribution"}\NormalTok{)}

\CommentTok{\# Plot}
\NormalTok{nmfplt\_1\_kl\_nndsvd\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}1)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_2\_kl\_nndsvd\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_3\_kl\_nndsvd\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}3)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_4\_kl\_nndsvd\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}4\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}4)\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_5\_kl\_nndsvd\_less\_o3\_5c }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}5\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}5)\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-56-1.pdf}

\paragraph{Fingerprint plot}\label{fingerprint-plot-3}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fingerprint }\OtherTok{\textless{}{-}} \FunctionTok{get\_fingerprint\_plot}\NormalTok{(H\_df\_5c\_less\_o3, }\FunctionTok{c}\NormalTok{(}
      \StringTok{\textquotesingle{}Traffic\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Combustion\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Oil \& Gas Emissions\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Flare (factor 4)\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}Flare (factor 5)\textquotesingle{}}
\NormalTok{    ))}
\NormalTok{fingerprint}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-57-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#ggsave("fingerprint.png", c)}
\end{Highlighting}
\end{Shaded}

\paragraph{Wind plot}\label{wind-plot-3}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wind\_plot }\OtherTok{\textless{}{-}} \FunctionTok{get\_wind\_plots}\NormalTok{(W, }\AttributeTok{y\_axis\_upper =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.225}\NormalTok{, }\FloatTok{0.08}\NormalTok{, }\FloatTok{0.18}\NormalTok{, }\FloatTok{0.09}\NormalTok{, }\FloatTok{0.1125}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-58-1.pdf}

\subsection{Comparing all four
methods}\label{comparing-all-four-methods}

Using RSS, WRSS, and KL

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{get\_residual }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(component, seed, method, objective) \{}
\NormalTok{  fitted }\OtherTok{\textless{}{-}} \FunctionTok{fitted}\NormalTok{(}\FunctionTok{get}\NormalTok{(}\FunctionTok{paste}\NormalTok{(method, seed, }\StringTok{\textquotesingle{}less\_o3\textquotesingle{}}\NormalTok{, }\AttributeTok{sep =} \StringTok{\textquotesingle{}\_\textquotesingle{}}\NormalTok{))}\SpecialCharTok{$}\NormalTok{fit[[component}\DecValTok{{-}3}\NormalTok{]])}
  \ControlFlowTok{if}\NormalTok{ (objective }\SpecialCharTok{==} \StringTok{\textquotesingle{}wrss\textquotesingle{}}\NormalTok{) \{}
    \FunctionTok{return}\NormalTok{(}\FunctionTok{sum}\NormalTok{(((normalized\_matrix\_less\_o3 }\SpecialCharTok{{-}}\NormalTok{ fitted) }\SpecialCharTok{*}\NormalTok{ weight\_matrix)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}\SpecialCharTok{/}\DecValTok{2}\NormalTok{)}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (objective }\SpecialCharTok{==} \StringTok{\textquotesingle{}kl\textquotesingle{}}\NormalTok{) \{}
\NormalTok{    log\_term }\OtherTok{\textless{}{-}}\NormalTok{ normalized\_matrix\_less\_o3}\SpecialCharTok{/}\NormalTok{fitted}
\NormalTok{    log\_term[log\_term}\SpecialCharTok{\textless{}}\NormalTok{.Machine}\SpecialCharTok{$}\NormalTok{double.eps] }\OtherTok{\textless{}{-}}\NormalTok{ .Machine}\SpecialCharTok{$}\NormalTok{double.eps}
    \FunctionTok{return}\NormalTok{(}\FunctionTok{sum}\NormalTok{(normalized\_matrix\_less\_o3 }\SpecialCharTok{*} \FunctionTok{log}\NormalTok{(log\_term) }\SpecialCharTok{+}\NormalTok{ fitted }\SpecialCharTok{{-}}\NormalTok{ normalized\_matrix\_less\_o3))}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (objective }\SpecialCharTok{==} \StringTok{\textquotesingle{}rss\textquotesingle{}}\NormalTok{) \{}
    \FunctionTok{return}\NormalTok{(}\FunctionTok{norm}\NormalTok{(normalized\_matrix\_less\_o3 }\SpecialCharTok{{-}}\NormalTok{ fitted, }\AttributeTok{type =} \StringTok{\textquotesingle{}F\textquotesingle{}}\NormalTok{)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{\}}

\NormalTok{df\_plot }\OtherTok{\textless{}{-}} \FunctionTok{expand\_grid}\NormalTok{(}
  \AttributeTok{component =}\NormalTok{ components,}
  \AttributeTok{seed =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}random\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}nndsvd\textquotesingle{}}\NormalTok{),}
  \AttributeTok{method =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}lsnmf\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}kl\textquotesingle{}}\NormalTok{),}
  \AttributeTok{objective =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}rss\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wrss\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}kl\textquotesingle{}}\NormalTok{)}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rowwise}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{residual =} \FunctionTok{get\_residual}\NormalTok{(component, seed, method, objective)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{model =} \FunctionTok{paste0}\NormalTok{(method, seed))}

\NormalTok{RSS\_plot }\OtherTok{\textless{}{-}}\NormalTok{ df\_plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(objective}\SpecialCharTok{==}\StringTok{\textquotesingle{}rss\textquotesingle{}}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ component, }\AttributeTok{y =}\NormalTok{ residual, }\AttributeTok{group =}\NormalTok{ model, }\AttributeTok{color =}\NormalTok{ model)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ component, }\AttributeTok{y =}\NormalTok{ residual, }\AttributeTok{group =}\NormalTok{ model, }\AttributeTok{color =}\NormalTok{ model)) }\SpecialCharTok{+}
  \FunctionTok{scale\_colour\_manual}\NormalTok{(}\StringTok{""}\NormalTok{, }
                    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"lsnmfrandom"}\NormalTok{, }\StringTok{"lsnmfnndsvd"}\NormalTok{,}
                               \StringTok{"klrandom"}\NormalTok{, }\StringTok{"klnndsvd"}\NormalTok{),}
                    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"tomato1"}\NormalTok{, }\StringTok{"dodgerblue"}\NormalTok{,}
                               \StringTok{"springgreen4"}\NormalTok{, }\StringTok{"darkorange"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{\textquotesingle{}Rank\textquotesingle{}}\NormalTok{, }\AttributeTok{y =} \StringTok{\textquotesingle{}Residual\textquotesingle{}}\NormalTok{, }\AttributeTok{title =} \StringTok{\textquotesingle{}RSS\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position=}\StringTok{"none"}\NormalTok{)}

\NormalTok{WRSS\_plot }\OtherTok{\textless{}{-}}\NormalTok{ df\_plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(objective}\SpecialCharTok{==}\StringTok{\textquotesingle{}wrss\textquotesingle{}}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ component, }\AttributeTok{y =}\NormalTok{ residual, }\AttributeTok{group =}\NormalTok{ model, }\AttributeTok{color =}\NormalTok{ model)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ component, }\AttributeTok{y =}\NormalTok{ residual, }\AttributeTok{group =}\NormalTok{ model, }\AttributeTok{color =}\NormalTok{ model)) }\SpecialCharTok{+}
  \FunctionTok{scale\_colour\_manual}\NormalTok{(}\StringTok{""}\NormalTok{, }
                  \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"lsnmfrandom"}\NormalTok{, }\StringTok{"lsnmfnndsvd"}\NormalTok{,}
                             \StringTok{"klrandom"}\NormalTok{, }\StringTok{"klnndsvd"}\NormalTok{),}
                  \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"tomato1"}\NormalTok{, }\StringTok{"dodgerblue"}\NormalTok{,}
                             \StringTok{"springgreen4"}\NormalTok{, }\StringTok{"darkorange"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{\textquotesingle{}Rank\textquotesingle{}}\NormalTok{, }\AttributeTok{y =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\AttributeTok{title =} \StringTok{\textquotesingle{}wrss\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position=}\StringTok{"none"}\NormalTok{)}

\NormalTok{KL\_plot }\OtherTok{\textless{}{-}}\NormalTok{ df\_plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(objective}\SpecialCharTok{==}\StringTok{\textquotesingle{}kl\textquotesingle{}}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ component, }\AttributeTok{y =}\NormalTok{ residual, }\AttributeTok{group =}\NormalTok{ model, }\AttributeTok{color =}\NormalTok{ model)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ component, }\AttributeTok{y =}\NormalTok{ residual, }\AttributeTok{group =}\NormalTok{ model, }\AttributeTok{color =}\NormalTok{ model)) }\SpecialCharTok{+}
  \FunctionTok{scale\_colour\_manual}\NormalTok{(}\StringTok{""}\NormalTok{, }
                    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"lsnmfrandom"}\NormalTok{, }\StringTok{"lsnmfnndsvd"}\NormalTok{,}
                               \StringTok{"klrandom"}\NormalTok{, }\StringTok{"klnndsvd"}\NormalTok{),}
                    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"tomato1"}\NormalTok{, }\StringTok{"dodgerblue"}\NormalTok{,}
                               \StringTok{"springgreen4"}\NormalTok{, }\StringTok{"darkorange"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{\textquotesingle{}Rank\textquotesingle{}}\NormalTok{, }\AttributeTok{y =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\AttributeTok{title =} \StringTok{\textquotesingle{}KL\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\FunctionTok{grid.arrange}\NormalTok{(RSS\_plot, WRSS\_plot, KL\_plot, }\AttributeTok{ncol=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-60-1.pdf}

\subsection{NMF with 5 source factors without
ozone}\label{nmf-with-5-source-factors-without-ozone}

\begin{itemize}
\tightlist
\item
  remove ozone
\item
  use KL divergence loss with svd seed
\item
  Extract W (basis) and H (coefs) matrices
\item
  Calculate variance explained in all 5 factors
\item
  Calculate variance explained by each factor
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nmf\_result\_5c\_less\_o3 }\OtherTok{\textless{}{-}}\NormalTok{ kl\_nndsvd\_less\_o3}\SpecialCharTok{$}\NormalTok{fit}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{5}\StringTok{\textasciigrave{}}

\NormalTok{basis\_matrix\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{basis}\NormalTok{(nmf\_result\_5c\_less\_o3) }\CommentTok{\#W}
\NormalTok{coef\_matrix\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(nmf\_result\_5c\_less\_o3) }\CommentTok{\#H}

\CommentTok{\# get variance explained by the factors (total residuals)}
\NormalTok{reconstruct}\OtherTok{\textless{}{-}}\FunctionTok{fitted}\NormalTok{(nmf\_result\_5c\_less\_o3)}

\NormalTok{tss }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{((normalized\_matrix\_less\_o3 }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(normalized\_matrix\_less\_o3))}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{rss }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{((normalized\_matrix\_less\_o3 }\SpecialCharTok{{-}}\NormalTok{ reconstruct)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{variance\_explained }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ (rss }\SpecialCharTok{/}\NormalTok{ tss)}
\NormalTok{variance\_explained}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9212864
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get variance explained by each factor separately}
\CommentTok{\# Compute variance explained by each factor}
\CommentTok{\# Initialize variance explained tracker}
\NormalTok{variance\_explained\_factors }\OtherTok{\textless{}{-}} \FunctionTok{numeric}\NormalTok{(}\DecValTok{5}\NormalTok{)}

\CommentTok{\# Incrementally add factors and calculate variance explained}
\NormalTok{reconstruction }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{0}\NormalTok{, }\AttributeTok{nrow =} \FunctionTok{nrow}\NormalTok{(basis\_matrix\_5c\_less\_o3), }\AttributeTok{ncol =} \FunctionTok{ncol}\NormalTok{(coef\_matrix\_5c\_less\_o3))}

\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{) \{}
  \CommentTok{\# Add the i{-}th factor to the reconstruction}
\NormalTok{  reconstruction }\OtherTok{\textless{}{-}}\NormalTok{ reconstruction }\SpecialCharTok{+}\NormalTok{ (basis\_matrix\_5c\_less\_o3[, i, }\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{] }\SpecialCharTok{\%*\%}\NormalTok{ coef\_matrix\_5c\_less\_o3[i, , }\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{])}
  
  \CommentTok{\# Compute Residual Sum of Squares (RSS)}
\NormalTok{  rss\_f }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{((normalized\_matrix\_less\_o3 }\SpecialCharTok{{-}}\NormalTok{ reconstruction)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
  
  \CommentTok{\# Compute Variance Explained by adding this factor}
\NormalTok{  variance\_explained\_factors[i] }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ (rss\_f }\SpecialCharTok{/}\NormalTok{ tss)}
\NormalTok{\}}

\CommentTok{\# Print variance explained by each factor cumulatively}
\NormalTok{variance\_explained\_factors}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.2395401 0.5113683 0.8113445 0.8921360 0.9212864
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{par}\NormalTok{(}\AttributeTok{mfrow =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\FunctionTok{image}\NormalTok{(basis\_matrix\_5c\_less\_o3, }\AttributeTok{main =} \StringTok{"Basis Matrix (W)"}\NormalTok{)}
\FunctionTok{image}\NormalTok{(coef\_matrix\_5c\_less\_o3, }\AttributeTok{main =} \StringTok{"Coefficient Matrix (H)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-61-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert H to a data frame for ggplot}
\NormalTok{H\_df\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(coef\_matrix\_5c\_less\_o3)}
\CommentTok{\# Add a column for chemicals}
\NormalTok{H\_df\_5c\_less\_o3}\SpecialCharTok{$}\NormalTok{Component }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(H\_df\_5c\_less\_o3)}

\CommentTok{\# Reshape data to long format}
\NormalTok{H\_long\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{pivot\_longer}\NormalTok{(H\_df\_5c\_less\_o3, }\AttributeTok{cols =} \SpecialCharTok{{-}}\NormalTok{Component, }
                                  \AttributeTok{names\_to =} \StringTok{"Chemical"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"Contribution"}\NormalTok{)}

\CommentTok{\# Plot}
\NormalTok{nmfplt\_1\_svd\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}1) Traffic emissions factor\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_2\_svd\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2) Combustion from engines, turbines, compressors\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_3\_svd\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}3) Oil \& gas fugitive and venting emssions\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_4\_svd\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}4\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}4) Flaring, incomplete combustion\textquotesingle{}}\NormalTok{)}
\NormalTok{nmfplt\_5\_svd\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{get\_component\_plot}\NormalTok{(H\_long\_5c\_less\_o3, }
                                           \StringTok{\textquotesingle{}5\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}5) Flaring, sour gas\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{NMF_final_files/figure-latex/unnamed-chunk-63-1.pdf}

\subsection{Factor analysis}\label{factor-analysis}

\begin{itemize}
\tightlist
\item
  merge in factors 1-5 to dataset (hourly)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# First look at how well this approximates}
\NormalTok{fitted\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{fitted}\NormalTok{(nmf\_result\_5c\_less\_o3)}
\FunctionTok{sum}\NormalTok{(}\FunctionTok{abs}\NormalTok{(normalized\_matrix\_less\_o3}\SpecialCharTok{{-}}\NormalTok{fitted\_5c\_less\_o3))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1059.63
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# NMF factorizes V = WH}
\CommentTok{\# Store Basis matrix (W) and Coef Matrix (H)}
\FunctionTok{saveRDS}\NormalTok{(basis\_matrix\_5c\_less\_o3, }\StringTok{\textquotesingle{}result\_rfiles/nmf\_norm\_5c\_less\_o3\_basis.rds\textquotesingle{}}\NormalTok{)}
\FunctionTok{saveRDS}\NormalTok{(coef\_matrix\_5c\_less\_o3, }\StringTok{\textquotesingle{}result\_rfiles/nmf\_norm\_5c\_less\_o3\_coef.rds\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Merge basis matrix into hourly observations}
\NormalTok{basis\_matrix\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(basis\_matrix\_5c\_less\_o3) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{setNames}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Factor1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Factor2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Factor3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Factor4\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Factor5\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if
## `.name_repair` is omitted as of tibble 2.0.0.
## i Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{normalized\_hourly\_data\_5c\_less\_o3 }\OtherTok{\textless{}{-}}\NormalTok{ hourly\_nona[,}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}day\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}time\_utc\textquotesingle{}}\NormalTok{)] }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{cbind}\NormalTok{(normalized\_matrix\_less\_o3) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{cbind}\NormalTok{(basis\_matrix\_5c\_less\_o3) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{right\_join}\NormalTok{(hourly\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\StringTok{\textquotesingle{}day\textquotesingle{}}\NormalTok{), }\FunctionTok{join\_by}\NormalTok{(time\_utc), }\AttributeTok{suffix =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}\_norm\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{))}

\CommentTok{\# saveRDS(normalized\_hourly\_data\_5c\_less\_o3, }
\CommentTok{\#  \textquotesingle{}result\_rfiles/normalized\_hourly\_data\_5c\_less\_o3.rds\textquotesingle{})}
\NormalTok{normalized\_hourly\_data\_5c\_less\_o3 }\OtherTok{\textless{}{-}} \FunctionTok{readRDS}\NormalTok{(}\StringTok{\textquotesingle{}result\_rfiles/normalized\_hourly\_data\_5c\_less\_o3.rds\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  make daily dataset for VNF analysis
\item
  compute wind directions from plots
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Also compute a daily dataset}
\NormalTok{normalized\_daily\_data\_5c\_less\_o3 }\OtherTok{\textless{}{-}}\NormalTok{ normalized\_hourly\_data\_5c\_less\_o3 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(day) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\FunctionTok{across}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric) }\SpecialCharTok{\&} \SpecialCharTok{!}\FunctionTok{any\_of}\NormalTok{(}\StringTok{\textquotesingle{}wdr\_deg\textquotesingle{}}\NormalTok{), }\SpecialCharTok{\textasciitilde{}} \FunctionTok{mean}\NormalTok{(.x, }\AttributeTok{na.rm =}\NormalTok{ T)),}
            \AttributeTok{wdr\_deg =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{mean}\NormalTok{(}\FunctionTok{circular}\NormalTok{(wdr\_deg, }\AttributeTok{units =} \StringTok{"degrees"}\NormalTok{), }\AttributeTok{na.rm =}\NormalTok{ T))) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{wdr\_deg =} \FunctionTok{if\_else}\NormalTok{(wdr\_deg }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{, wdr\_deg}\SpecialCharTok{+}\DecValTok{360}\NormalTok{, wdr\_deg)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{wind\_45\_135 =}\NormalTok{ wdr\_deg }\SpecialCharTok{\textgreater{}=} \DecValTok{45} \SpecialCharTok{\&}\NormalTok{ wdr\_deg }\SpecialCharTok{\textless{}} \DecValTok{135}\NormalTok{,}
         \AttributeTok{wind\_135\_180 =}\NormalTok{ wdr\_deg }\SpecialCharTok{\textgreater{}=} \DecValTok{135} \SpecialCharTok{\&}\NormalTok{ wdr\_deg }\SpecialCharTok{\textless{}} \DecValTok{180}\NormalTok{,}
         \AttributeTok{wind\_180\_270 =}\NormalTok{ wdr\_deg }\SpecialCharTok{\textgreater{}=} \DecValTok{180} \SpecialCharTok{\&}\NormalTok{ wdr\_deg }\SpecialCharTok{\textless{}} \DecValTok{270}\NormalTok{,}
         \AttributeTok{wind\_270\_45 =}\NormalTok{ wdr\_deg }\SpecialCharTok{\textgreater{}=} \DecValTok{270} \SpecialCharTok{\&}\NormalTok{ wdr\_deg }\SpecialCharTok{\textless{}} \DecValTok{45}\NormalTok{)}

\CommentTok{\# saveRDS(normalized\_daily\_data\_5c\_less\_o3, }
\CommentTok{\#  \textquotesingle{}result\_rfiles/normalized\_daily\_data\_5c\_less\_o3.rds\textquotesingle{})}

\NormalTok{normalized\_daily\_data\_5c\_less\_o3 }\OtherTok{\textless{}{-}} 
  \FunctionTok{readRDS}\NormalTok{(}\StringTok{\textquotesingle{}result\_rfiles/normalized\_daily\_data\_5c\_less\_o3.rds\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \begin{enumerate}
  \def\labelenumi{\arabic{enumi})}
  \tightlist
  \item
    number of flares in 100km of trailer associated with NMF
  \end{enumerate}
\item
  \begin{enumerate}
  \def\labelenumi{\arabic{enumi})}
  \setcounter{enumi}{1}
  \tightlist
  \item
    weighted count based on distance to trailer
  \end{enumerate}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Check if relationship between \# flares and flare factor (4 \& 5)}
\CommentTok{\# Linear model}
\NormalTok{flare\_factor }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(n\_flare\_100 }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Factor1 }\SpecialCharTok{+}\NormalTok{ Factor2 }\SpecialCharTok{+}\NormalTok{ Factor3 }\SpecialCharTok{+}\NormalTok{ Factor4 }\SpecialCharTok{+}\NormalTok{ Factor5, }
                   \AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = n_flare_100 ~ Factor1 + Factor2 + Factor3 + Factor4 + 
##     Factor5, data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -54.638 -22.160   4.205  18.488  76.270 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)   52.438      7.455   7.034 1.61e-11 ***
## Factor1      -27.402    106.172  -0.258   0.7965    
## Factor2     -338.560    196.573  -1.722   0.0861 .  
## Factor3      286.534    151.310   1.894   0.0593 .  
## Factor4     -287.536    244.717  -1.175   0.2410    
## Factor5      231.978    212.510   1.092   0.2760    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 27.79 on 273 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.03877,    Adjusted R-squared:  0.02117 
## F-statistic: 2.202 on 5 and 273 DF,  p-value: 0.05434
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{flare\_factor45 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(n\_flare\_100 }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Factor4 }\SpecialCharTok{+}\NormalTok{ Factor5, }\AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor45)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = n_flare_100 ~ Factor4 + Factor5, data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -53.409 -23.830   5.588  18.235  77.131 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)   40.780      3.386  12.044   <2e-16 ***
## Factor4      -48.431    150.383  -0.322   0.7477    
## Factor5      360.559    206.393   1.747   0.0818 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 28.02 on 276 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.01171,    Adjusted R-squared:  0.004548 
## F-statistic: 1.635 on 2 and 276 DF,  p-value: 0.1968
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{flare\_factor\_weighted }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weighted.count }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Factor1 }\SpecialCharTok{+}\NormalTok{ Factor2 }\SpecialCharTok{+}\NormalTok{ Factor3 }\SpecialCharTok{+}\NormalTok{ Factor4 }\SpecialCharTok{+}\NormalTok{ Factor5, }
                            \AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor\_weighted)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weighted.count ~ Factor1 + Factor2 + Factor3 + Factor4 + 
##     Factor5, data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.3295 -0.2180  0.0546  0.3809  3.9848 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)   2.2572     0.2278   9.907   <2e-16 ***
## Factor1       0.1244     3.2450   0.038   0.9694    
## Factor2      -4.7740     6.0080  -0.795   0.4275    
## Factor3       7.4339     4.6246   1.607   0.1091    
## Factor4     -12.9155     7.4794  -1.727   0.0853 .  
## Factor5       4.0762     6.4951   0.628   0.5308    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.8492 on 273 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.02221,    Adjusted R-squared:  0.0043 
## F-statistic:  1.24 on 5 and 273 DF,  p-value: 0.2905
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{flare\_factor\_weighted45 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weighted.count }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Factor4 }\SpecialCharTok{+}\NormalTok{ Factor5, }
                              \AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor\_weighted45)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weighted.count ~ Factor4 + Factor5, data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.2558 -0.1821  0.0775  0.3622  3.9366 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)   2.0910     0.1029  20.315   <2e-16 ***
## Factor4      -4.0144     4.5712  -0.878    0.381    
## Factor5       7.3663     6.2738   1.174    0.241    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.8518 on 276 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.005595,   Adjusted R-squared:  -0.001611 
## F-statistic: 0.7765 on 2 and 276 DF,  p-value: 0.461
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# All factors + wind speed + wind direction + factor5:sw wind.}
\CommentTok{\# Wind direction from 270 to 45 is left as reference group.}
\NormalTok{flare\_factor\_weighted\_2 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weighted.count }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Factor1 }\SpecialCharTok{+}\NormalTok{ Factor2 }\SpecialCharTok{+}\NormalTok{ Factor3 }\SpecialCharTok{+} 
\NormalTok{                                Factor4 }\SpecialCharTok{+}\NormalTok{ Factor5 }\SpecialCharTok{+}\NormalTok{ wsp\_ms }\SpecialCharTok{+}\NormalTok{ wind\_45\_135 }\SpecialCharTok{+} 
\NormalTok{                                wind\_135\_180 }\SpecialCharTok{+}\NormalTok{ Factor5}\SpecialCharTok{*}\NormalTok{wind\_180\_270, }
                              \AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor\_weighted\_2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weighted.count ~ Factor1 + Factor2 + Factor3 + Factor4 + 
##     Factor5 + wsp_ms + wind_45_135 + wind_135_180 + Factor5 * 
##     wind_180_270, data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.4382 -0.2036  0.0782  0.3578  3.9528 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(>|t|)    
## (Intercept)                2.14418    0.33390   6.422 6.11e-10 ***
## Factor1                    0.07365    3.35780   0.022   0.9825    
## Factor2                   -4.92773    6.19462  -0.795   0.4270    
## Factor3                    8.99603    4.80767   1.871   0.0624 .  
## Factor4                  -10.66714    7.82960  -1.362   0.1742    
## Factor5                    3.28556    7.52447   0.437   0.6627    
## wsp_ms                     0.04430    0.04523   0.980   0.3282    
## wind_45_135TRUE           -0.15557    0.17743  -0.877   0.3814    
## wind_135_180TRUE          -0.15153    0.13270  -1.142   0.2545    
## wind_180_270TRUE          -0.21667    0.22628  -0.958   0.3392    
## Factor5:wind_180_270TRUE   2.51821   13.08348   0.192   0.8475    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.8524 on 268 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.03302,    Adjusted R-squared:  -0.003061 
## F-statistic: 0.9152 on 10 and 268 DF,  p-value: 0.5196
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Same as above but only factor 4 and 5}
\NormalTok{flare\_factor\_weighted\_3 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weighted.count }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Factor4 }\SpecialCharTok{+}\NormalTok{ Factor5 }\SpecialCharTok{+}\NormalTok{ wsp\_ms }\SpecialCharTok{+} 
\NormalTok{                                Factor5}\SpecialCharTok{*}\NormalTok{wind\_180\_270, }
                              \AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor\_weighted\_3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weighted.count ~ Factor4 + Factor5 + wsp_ms + Factor5 * 
##     wind_180_270, data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.2706 -0.1961  0.0714  0.3721  3.9358 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(>|t|)    
## (Intercept)               2.057728   0.222033   9.268   <2e-16 ***
## Factor4                  -3.273445   5.155494  -0.635    0.526    
## Factor5                   7.499668   7.297235   1.028    0.305    
## wsp_ms                    0.009441   0.040855   0.231    0.817    
## wind_180_270TRUE         -0.059345   0.215638  -0.275    0.783    
## Factor5:wind_180_270TRUE -0.078349  12.897092  -0.006    0.995    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.856 on 273 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.006554,   Adjusted R-squared:  -0.01164 
## F-statistic: 0.3602 on 5 and 273 DF,  p-value: 0.8754
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Same as above but interaction between factor 4 and SW wind}
\NormalTok{flare\_factor\_weighted\_3b }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weighted.count }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Factor4 }\SpecialCharTok{+}\NormalTok{ Factor5 }\SpecialCharTok{+}\NormalTok{ wsp\_ms }\SpecialCharTok{+} 
\NormalTok{                                 Factor4}\SpecialCharTok{*}\NormalTok{wind\_180\_270, }
                               \AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor\_weighted\_3b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weighted.count ~ Factor4 + Factor5 + wsp_ms + Factor4 * 
##     wind_180_270, data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.3058 -0.2123  0.0650  0.3774  3.9523 
## 
## Coefficients:
##                            Estimate Std. Error t value Pr(>|t|)    
## (Intercept)                2.030311   0.215853   9.406   <2e-16 ***
## Factor4                   -0.841684   5.604781  -0.150    0.881    
## Factor5                    7.401203   6.365967   1.163    0.246    
## wsp_ms                     0.005478   0.040870   0.134    0.893    
## wind_180_270TRUE           0.143565   0.224432   0.640    0.523    
## Factor4:wind_180_270TRUE -10.510472   9.618074  -1.093    0.275    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.8541 on 273 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.01088,    Adjusted R-squared:  -0.007235 
## F-statistic: 0.6006 on 5 and 273 DF,  p-value: 0.6995
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Same as above but with East wind}
\NormalTok{flare\_factor\_weighted\_3c }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weighted.count }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Factor4 }\SpecialCharTok{+}\NormalTok{ Factor5 }\SpecialCharTok{+}\NormalTok{ wsp\_ms }\SpecialCharTok{+} 
\NormalTok{                                 Factor5}\SpecialCharTok{*}\NormalTok{wind\_45\_135, }
                               \AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor\_weighted\_3c)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weighted.count ~ Factor4 + Factor5 + wsp_ms + Factor5 * 
##     wind_45_135, data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.2355 -0.1832  0.0761  0.3768  3.9129 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(>|t|)    
## (Intercept)              2.1177298  0.2207356   9.594   <2e-16 ***
## Factor4                 -4.0986004  5.1120629  -0.802    0.423    
## Factor5                  6.1846170  6.5540446   0.944    0.346    
## wsp_ms                   0.0008777  0.0407876   0.022    0.983    
## wind_45_135TRUE         -0.4275903  0.3752245  -1.140    0.255    
## Factor5:wind_45_135TRUE 22.0187173 23.3341439   0.944    0.346    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.8543 on 273 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.01053,    Adjusted R-squared:  -0.007588 
## F-statistic: 0.5813 on 5 and 273 DF,  p-value: 0.7143
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{flare\_factor\_weighted\_3d }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weighted.count }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Factor4 }\SpecialCharTok{+}\NormalTok{ Factor5 }\SpecialCharTok{+}\NormalTok{ wsp\_ms }\SpecialCharTok{+} 
\NormalTok{                                 Factor4}\SpecialCharTok{*}\NormalTok{wind\_45\_135, }
                               \AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor\_weighted\_3d)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weighted.count ~ Factor4 + Factor5 + wsp_ms + Factor4 * 
##     wind_45_135, data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.2680 -0.1822  0.0707  0.3665  3.9260 
## 
## Coefficients:
##                         Estimate Std. Error t value Pr(>|t|)    
## (Intercept)              2.09473    0.21997   9.523   <2e-16 ***
## Factor4                 -4.50558    5.36882  -0.839    0.402    
## Factor5                  7.78444    6.38818   1.219    0.224    
## wsp_ms                   0.00343    0.04074   0.084    0.933    
## wind_45_135TRUE         -0.19324    0.28449  -0.679    0.498    
## Factor4:wind_45_135TRUE  4.84677   13.38860   0.362    0.718    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.8555 on 273 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.007783,   Adjusted R-squared:  -0.01039 
## F-statistic: 0.4283 on 5 and 273 DF,  p-value: 0.8288
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Wind speed + factor 4 and interaction with East wind}
\NormalTok{flare\_factor\_weighted\_4a }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weighted.count }\SpecialCharTok{\textasciitilde{}}\NormalTok{ wsp\_ms }\SpecialCharTok{+}\NormalTok{ Factor4}\SpecialCharTok{*}\NormalTok{wind\_45\_135, }
                               \AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor\_weighted\_4a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weighted.count ~ wsp_ms + Factor4 * wind_45_135, 
##     data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.1668 -0.1983  0.0661  0.3882  3.8663 
## 
## Coefficients:
##                          Estimate Std. Error t value Pr(>|t|)    
## (Intercept)              2.187226   0.206642  10.585   <2e-16 ***
## wsp_ms                  -0.003785   0.040343  -0.094    0.925    
## Factor4                 -2.428778   5.095632  -0.477    0.634    
## wind_45_135TRUE         -0.171010   0.284161  -0.602    0.548    
## Factor4:wind_45_135TRUE  3.879541  13.376874   0.290    0.772    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.8562 on 274 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.002386,   Adjusted R-squared:  -0.01218 
## F-statistic: 0.1638 on 4 and 274 DF,  p-value: 0.9565
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Wind speed + factor 4 and interaction with SE wind}
\NormalTok{flare\_factor\_weighted\_4b }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weighted.count }\SpecialCharTok{\textasciitilde{}}\NormalTok{ wsp\_ms }\SpecialCharTok{+}\NormalTok{ Factor4}\SpecialCharTok{*}\NormalTok{wind\_135\_180, }
                               \AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor\_weighted\_4b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weighted.count ~ wsp_ms + Factor4 * wind_135_180, 
##     data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.2269 -0.2186  0.0794  0.3693  3.8404 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(>|t|)    
## (Intercept)               2.229232   0.202818  10.991   <2e-16 ***
## wsp_ms                    0.001297   0.039954   0.032   0.9741    
## Factor4                  -5.716640   5.512131  -1.037   0.3006    
## wind_135_180TRUE         -0.440258   0.229503  -1.918   0.0561 .  
## Factor4:wind_135_180TRUE 18.354002   9.757795   1.881   0.0610 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.851 on 274 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.01456,    Adjusted R-squared:  0.0001782 
## F-statistic: 1.012 on 4 and 274 DF,  p-value: 0.4014
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Wind speed + factor 4 and interaction with SW wind}
\NormalTok{flare\_factor\_weighted\_4c }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weighted.count }\SpecialCharTok{\textasciitilde{}}\NormalTok{ wsp\_ms }\SpecialCharTok{+}\NormalTok{ Factor4}\SpecialCharTok{*}\NormalTok{wind\_180\_270, }
                               \AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor\_weighted\_4c)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weighted.count ~ wsp_ms + Factor4 * wind_180_270, 
##     data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.1911 -0.1952  0.0539  0.4087  3.8937 
## 
## Coefficients:
##                            Estimate Std. Error t value Pr(>|t|)    
## (Intercept)                2.121372   0.201270  10.540   <2e-16 ***
## wsp_ms                    -0.001567   0.040444  -0.039    0.969    
## Factor4                    1.058349   5.364665   0.197    0.844    
## wind_180_270TRUE           0.143445   0.224576   0.639    0.524    
## Factor4:wind_180_270TRUE -10.634150   9.623656  -1.105    0.270    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.8547 on 274 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.005983,   Adjusted R-squared:  -0.008528 
## F-statistic: 0.4123 on 4 and 274 DF,  p-value: 0.7997
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Wind speed + factor 5 and interaction with East wind}
\NormalTok{flare\_factor\_weighted\_5a }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weighted.count }\SpecialCharTok{\textasciitilde{}}\NormalTok{ wsp\_ms }\SpecialCharTok{+}\NormalTok{ Factor5}\SpecialCharTok{*}\NormalTok{wind\_45\_135, }
                               \AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor\_weighted\_5a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weighted.count ~ wsp_ms + Factor5 * wind_45_135, 
##     data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.2299 -0.1901  0.0789  0.3725  3.9421 
## 
## Coefficients:
##                         Estimate Std. Error t value Pr(>|t|)    
## (Intercept)              2.01637    0.18083  11.151   <2e-16 ***
## wsp_ms                   0.01530    0.03658   0.418    0.676    
## Factor5                  4.62551    6.25483   0.740    0.460    
## wind_45_135TRUE         -0.40644    0.37405  -1.087    0.278    
## Factor5:wind_45_135TRUE 21.30900   23.30214   0.914    0.361    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.8537 on 274 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.008204,   Adjusted R-squared:  -0.006275 
## F-statistic: 0.5666 on 4 and 274 DF,  p-value: 0.6871
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Wind speed + factor 5 and interaction with SE wind}
\NormalTok{flare\_factor\_weighted\_5b }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weighted.count }\SpecialCharTok{\textasciitilde{}}\NormalTok{ wsp\_ms }\SpecialCharTok{+}\NormalTok{ Factor5}\SpecialCharTok{*}\NormalTok{wind\_135\_180, }
                               \AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor\_weighted\_5b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weighted.count ~ wsp_ms + Factor5 * wind_135_180, 
##     data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.2259 -0.1876  0.0693  0.3775  3.9290 
## 
## Coefficients:
##                          Estimate Std. Error t value Pr(>|t|)    
## (Intercept)               2.02295    0.18889  10.710   <2e-16 ***
## wsp_ms                    0.01822    0.03643   0.500    0.618    
## Factor5                   4.19811    7.25463   0.579    0.563    
## wind_135_180TRUE         -0.15866    0.20317  -0.781    0.436    
## Factor5:wind_135_180TRUE  6.06208   12.22399   0.496    0.620    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.8545 on 274 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.006345,   Adjusted R-squared:  -0.008161 
## F-statistic: 0.4374 on 4 and 274 DF,  p-value: 0.7816
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Wind speed + factor 5 and interaction with SW wind}
\NormalTok{flare\_factor\_weighted\_5c }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weighted.count }\SpecialCharTok{\textasciitilde{}}\NormalTok{ wsp\_ms }\SpecialCharTok{+}\NormalTok{ Factor5}\SpecialCharTok{*}\NormalTok{wind\_180\_270, }
                               \AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor\_weighted\_5c)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weighted.count ~ wsp_ms + Factor5 * wind_180_270, 
##     data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.2696 -0.2009  0.0671  0.3748  3.9556 
## 
## Coefficients:
##                          Estimate Std. Error t value Pr(>|t|)    
## (Intercept)               1.98021    0.18525  10.689   <2e-16 ***
## wsp_ms                    0.02098    0.03655   0.574    0.566    
## Factor5                   6.25646    7.02199   0.891    0.374    
## wind_180_270TRUE         -0.06960    0.21480  -0.324    0.746    
## Factor5:wind_180_270TRUE -0.16687   12.88229  -0.013    0.990    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.8551 on 274 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.005087,   Adjusted R-squared:  -0.009438 
## F-statistic: 0.3502 on 4 and 274 DF,  p-value: 0.8438
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Check relationship between avg flare distance and flare factor (4 \& 5)}
\CommentTok{\# Linear model}
\NormalTok{flare\_factor\_dist }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(distToLovi }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Factor4 }\SpecialCharTok{+}\NormalTok{ Factor5, }\AttributeTok{data =}\NormalTok{ normalized\_daily\_data\_5c\_less\_o3)}
\FunctionTok{summary}\NormalTok{(flare\_factor\_dist)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = distToLovi ~ Factor4 + Factor5, data = normalized_daily_data_5c_less_o3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -34.449  -2.443  -0.139   2.266  31.399 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  54.7821     0.8756  62.564   <2e-16 ***
## Factor4       7.2656    39.7289   0.183    0.855    
## Factor5      64.5797    52.2590   1.236    0.218    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 6.883 on 252 degrees of freedom
##   (25 observations deleted due to missingness)
## Multiple R-squared:  0.008425,   Adjusted R-squared:  0.0005557 
## F-statistic: 1.071 on 2 and 252 DF,  p-value: 0.3444
\end{verbatim}

\end{document}
