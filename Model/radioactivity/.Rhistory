knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(geosphere)
library(circular)
library(lwgeom)
library(sf)
library(units)
library(ggcorrplot)
library(kableExtra)
# set working directory to file location, this is table from flare_trailer_data_prep.Rmd
full_merged<-read.csv("table6_new.csv")
View(full_merged)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(geosphere)
library(circular)
library(lwgeom)
library(sf)
library(units)
library(ggcorrplot)
library(kableExtra)
# set working directory to file location, this is table from flare_trailer_data_prep.Rmd
full_merged<-read.csv("table6_new.csv")
# Run this if only want days with >1 flares within 50km radius
# full_merged <- full_merged %>%
#   filter(n_flare_50 > 0)
# Variables for the model
# 11 am - 5pm (for other analyses, not VIIRS)
# satellite overpass for night
response <- c('ch4', 'benzene', 'co', 'co2', 'nox', 'h2s','so2',
'ethane', 'ethene', 'total_radioactivity',
'Factor1', 'Factor2', 'Factor3', 'Factor4', 'Factor5')
predictors_fixed <- c('wsp_ms.night', 'weighted_monthly_oil',
'weighted_monthly_gas')
wind_bins <- c('SE', 'SW', 'NW')
wind_bins_list <- unlist(
lapply(1:length(wind_bins), function(k) combn(wind_bins, k, simplify = FALSE)),
recursive = FALSE
)
wind_bins_list <- append(wind_bins_list, 'bin')
distances <- c(5,10,20,30,50)
compound_flare_lm_result <- tibble(Compound = character(),
Radius = numeric(),
'Wind Direction' = character(),
'Adj R-sq' = numeric(),
'df' = numeric(),
Significant_Variables = character())
for (trailer_compound in response) {
for (distance in distances) {
for (wind_bins in wind_bins_list) {
predictors_wind_dir_var_temp <- paste(paste0('wind_', wind_bins, '.night'), collapse = '+')
predictors_dist_var_temp <- paste0('n_flare', paste0('_', distance))
formula_feature_str <- paste(
c(
predictors_fixed,
predictors_wind_dir_var_temp,
predictors_dist_var_temp
),
collapse = ' + '
)
formula_str <- paste(paste0(trailer_compound, '.night'),
formula_feature_str,
sep = ' ~ ')
formula <- as.formula(formula_str)
model <- lm(formula, data = full_merged)
assign(paste0(
trailer_compound,
'_count_',
distance,
'km_wind',
paste0(wind_bins, collapse = '')
),
model)
summary <- summary(model)
# Extract significant variables (p < 0.05)
coefs <- summary$coefficients
significant_vars <- rownames(coefs)[coefs[, 4] <= 0.05]
significant_vars_str <- paste(significant_vars, collapse = ', ')
compound_flare_lm_result <- compound_flare_lm_result %>%
add_row(
Compound = trailer_compound,
Radius = distance,
'Wind Direction' = paste(wind_bins, collapse = ','),
'Adj R-sq' = round(summary$adj.r.squared, 3),
'df' = summary$df[2],
Significant_Variables = significant_vars_str
)
}
}
}
# Show the results of models with combinations of the 3 bins.
compound_flare_lm_result %>%
filter(`Wind Direction` != 'bin') %>%
select(Compound, Radius, `Wind Direction`,  `Adj R-sq`, df, Significant_Variables) %>%
kable("html", caption = "Full Regression Results") %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
full_width = FALSE,
position = "left")
compound_flare_lm_result %>%
filter(`Wind Direction` != 'bin') %>%
select(Compound, Radius, `Wind Direction`, `Adj R-sq`, Significant_Variables) %>%
write.csv("full_regression_results_with_methane_eq_3windbins.csv", row.names = FALSE)
